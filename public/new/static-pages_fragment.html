

<h1 class="title">Ruby on Rails Tutorial </h1>


<h1 class="subtitle">  Learn Rails by Example</h1>


<h2 class="author">Michael Hartl</h2>




<h1 class="contents">Contents</h1>


<div id="table_of_contents"><ol><li class="chapter"><a href="beginning#top"><span class="number">Chapter 1</span> From zero to deploy</a></li><li><ol><li class="section"><a href="beginning#sec:introduction"><span class="number">1.1</span> Introduction</a></li><li><ol><li class="subsection"><a href="beginning#sec:comments_for_various_readers"><span class="number">1.1.1</span> Comments for various readers</a></li><li class="subsection"><a href="beginning#sec:1.1.2"><span class="number">1.1.2</span> &ldquo;Scaling&rdquo; Rails</a></li><li class="subsection"><a href="beginning#sec:conventions"><span class="number">1.1.3</span> Conventions in this book</a></li></ol></li><li class="section"><a href="beginning#sec:up_and_running"><span class="number">1.2</span> Up and running</a></li><li><ol><li class="subsection"><a href="beginning#sec:development_tools"><span class="number">1.2.1</span> Development environments</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:1.2.1.1">IDEs</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.2">Text editors and command lines</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.3">Browsers</a></li><li class="subsubsection"><a href="beginning#sec:1.2.1.4">A note about tools</a></li></ol></li><li class="subsection"><a href="beginning#sec:rubygems"><span class="number">1.2.2</span> Ruby, RubyGems, Rails, and Git</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:rails_installer_windows">Rails Installer (Windows)</a></li><li class="subsubsection"><a href="beginning#sec:install_git">Install Git</a></li><li class="subsubsection"><a href="beginning#sec:install_ruby">Install Ruby</a></li><li class="subsubsection"><a href="beginning#sec:install_rubygems">Install RubyGems</a></li><li class="subsubsection"><a href="beginning#sec:install_rails">Install Rails</a></li></ol></li><li class="subsection"><a href="beginning#sec:the_first_application"><span class="number">1.2.3</span> The first application</a></li><li class="subsection"><a href="beginning#sec:bundler"><span class="number">1.2.4</span> Bundler</a></li><li class="subsection"><a href="beginning#sec:rails_server"><span class="number">1.2.5</span> <code>rails server</code></a></li><li class="subsection"><a href="beginning#sec:mvc"><span class="number">1.2.6</span> Model-view-controller (MVC)</a></li></ol></li><li class="section"><a href="beginning#sec:version_control"><span class="number">1.3</span> Version control with Git</a></li><li><ol><li class="subsection"><a href="beginning#sec:git_setup"><span class="number">1.3.1</span> Installation and setup</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:1.3.1.1">First-time system setup</a></li><li class="subsubsection"><a href="beginning#sec:1.3.1.2">First-time repository setup</a></li></ol></li><li class="subsection"><a href="beginning#sec:adding_and_committing"><span class="number">1.3.2</span> Adding and committing</a></li><li class="subsection"><a href="beginning#sec:1.3.3"><span class="number">1.3.3</span> What good does Git do you?</a></li><li class="subsection"><a href="beginning#sec:github"><span class="number">1.3.4</span> GitHub</a></li><li class="subsection"><a href="beginning#sec:git_commands"><span class="number">1.3.5</span> Branch, edit, commit, merge</a></li><li><ol><li class="subsubsection"><a href="beginning#sec:git_branch">Branch</a></li><li class="subsubsection"><a href="beginning#sec:git_edit">Edit</a></li><li class="subsubsection"><a href="beginning#sec:git_commit">Commit</a></li><li class="subsubsection"><a href="beginning#sec:git_merge">Merge</a></li><li class="subsubsection"><a href="beginning#sec:git_push">Push</a></li></ol></li></ol></li><li class="section"><a href="beginning#sec:deploying"><span class="number">1.4</span> Deploying</a></li><li><ol><li class="subsection"><a href="beginning#sec:1.4.1"><span class="number">1.4.1</span> Heroku setup</a></li><li class="subsection"><a href="beginning#sec:heroku_step_one"><span class="number">1.4.2</span> Heroku deployment, step one</a></li><li class="subsection"><a href="beginning#sec:1.4.3"><span class="number">1.4.3</span> Heroku deployment, step two</a></li><li class="subsection"><a href="beginning#sec:heroku_commands"><span class="number">1.4.4</span> Heroku commands</a></li></ol></li><li class="section"><a href="beginning#sec:beginning_conclusion"><span class="number">1.5</span> Conclusion</a></li></ol></li><li class="chapter"><a href="a-demo-app#top"><span class="number">Chapter 2</span> A demo app</a></li><li><ol><li class="section"><a href="a-demo-app#sec:planning_the_application"><span class="number">2.1</span> Planning the application</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:modeling_users"><span class="number">2.1.1</span> Modeling users</a></li><li class="subsection"><a href="a-demo-app#sec:modeling_microposts"><span class="number">2.1.2</span> Modeling microposts</a></li></ol></li><li class="section"><a href="a-demo-app#sec:demo_users_resource"><span class="number">2.2</span> The Users resource</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:a_user_tour"><span class="number">2.2.1</span> A user tour</a></li><li class="subsection"><a href="a-demo-app#sec:mvc_in_action"><span class="number">2.2.2</span> MVC in action</a></li><li class="subsection"><a href="a-demo-app#sec:weaknesses_of_this_users_resource"><span class="number">2.2.3</span> Weaknesses of this Users resource</a></li></ol></li><li class="section"><a href="a-demo-app#sec:microposts_resource"><span class="number">2.3</span> The Microposts resource</a></li><li><ol><li class="subsection"><a href="a-demo-app#sec:a_micropost_microtour"><span class="number">2.3.1</span> A micropost microtour</a></li><li class="subsection"><a href="a-demo-app#sec:putting_the_micro_in_microposts"><span class="number">2.3.2</span> Putting the <em>micro</em> in microposts</a></li><li class="subsection"><a href="a-demo-app#sec:demo_user_has_many_microposts"><span class="number">2.3.3</span> A user <code>has_many</code> microposts</a></li><li class="subsection"><a href="a-demo-app#sec:inheritance_hierarchies"><span class="number">2.3.4</span> Inheritance hierarchies</a></li><li class="subsection"><a href="a-demo-app#sec:deploying_the_demo_app"><span class="number">2.3.5</span> Deploying the demo app</a></li></ol></li><li class="section"><a href="a-demo-app#sec:2.4"><span class="number">2.4</span> Conclusion</a></li></ol></li><li class="chapter"><a href="static-pages#top"><span class="number">Chapter 3</span> Mostly static pages</a></li><li><ol><li class="section"><a href="static-pages#sec:static_pages"><span class="number">3.1</span> Static pages</a></li><li><ol><li class="subsection"><a href="static-pages#sec:truly_static_pages"><span class="number">3.1.1</span> Truly static pages</a></li><li class="subsection"><a href="static-pages#sec:static_pages_with_rails"><span class="number">3.1.2</span> Static pages with Rails</a></li></ol></li><li class="section"><a href="static-pages#sec:first_tests"><span class="number">3.2</span> Our first tests</a></li><li><ol><li class="subsection"><a href="static-pages#sec:testing_tools"><span class="number">3.2.1</span> Testing tools</a></li><li><ol><li class="subsubsection"><a href="static-pages#sec:autotest">Autotest</a></li></ol></li><li class="subsection"><a href="static-pages#sec:TDD"><span class="number">3.2.2</span> TDD: Red, Green, Refactor</a></li><li><ol><li class="subsubsection"><a href="static-pages#sec:spork">Spork</a></li><li class="subsubsection"><a href="static-pages#sec:red">Red</a></li><li class="subsubsection"><a href="static-pages#sec:green">Green</a></li><li class="subsubsection"><a href="static-pages#sec:refactor">Refactor</a></li></ol></li></ol></li><li class="section"><a href="static-pages#sec:slightly_dynamic_pages"><span class="number">3.3</span> Slightly dynamic pages</a></li><li><ol><li class="subsection"><a href="static-pages#sec:testing_a_title_change"><span class="number">3.3.1</span> Testing a title change</a></li><li class="subsection"><a href="static-pages#sec:passing_title_tests"><span class="number">3.3.2</span> Passing title tests</a></li><li class="subsection"><a href="static-pages#sec:instance_variables_embedded_ruby"><span class="number">3.3.3</span> Instance variables and Embedded Ruby</a></li><li class="subsection"><a href="static-pages#sec:layouts"><span class="number">3.3.4</span> Eliminating duplication with layouts</a></li></ol></li><li class="section"><a href="static-pages#sec:static_pages_conclusion"><span class="number">3.4</span> Conclusion</a></li><li class="section"><a href="static-pages#sec:static_pages_exercises"><span class="number">3.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="rails-flavored-ruby#top"><span class="number">Chapter 4</span> Rails-flavored Ruby</a></li><li><ol><li class="section"><a href="rails-flavored-ruby#sec:motivation"><span class="number">4.1</span> Motivation</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:title_helper"><span class="number">4.1.1</span> A <code>title</code> helper</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:cascading_style_sheets"><span class="number">4.1.2</span> Cascading Style Sheets</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:strings_and_methods"><span class="number">4.2</span> Strings and methods</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:comments"><span class="number">4.2.1</span> Comments</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:strings"><span class="number">4.2.2</span> Strings</a></li><li><ol><li class="subsubsection"><a href="rails-flavored-ruby#sec:printing">Printing</a></li><li class="subsubsection"><a href="rails-flavored-ruby#sec:single_quoted_strings">Single-quoted strings</a></li></ol></li><li class="subsection"><a href="rails-flavored-ruby#sec:objects_and_message_passing"><span class="number">4.2.3</span> Objects and message passing</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:method_definitions"><span class="number">4.2.4</span> Method definitions</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:back_to_the_title_helper"><span class="number">4.2.5</span> Back to the <code>title</code> helper</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:other_data_structures"><span class="number">4.3</span> Other data structures</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:arrays_and_ranges"><span class="number">4.3.1</span> Arrays and ranges</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:blocks"><span class="number">4.3.2</span> Blocks</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:hashes_and_symbols"><span class="number">4.3.3</span> Hashes and symbols</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:css_revisited"><span class="number">4.3.4</span> CSS revisited</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:ruby_classes"><span class="number">4.4</span> Ruby classes</a></li><li><ol><li class="subsection"><a href="rails-flavored-ruby#sec:constructors"><span class="number">4.4.1</span> Constructors</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_class_of_our_own"><span class="number">4.4.2</span> Class inheritance</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:modifying_built_in_classes"><span class="number">4.4.3</span> Modifying built-in classes</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_controller_class"><span class="number">4.4.4</span> A controller class</a></li><li class="subsection"><a href="rails-flavored-ruby#sec:a_user_class"><span class="number">4.4.5</span> A user class</a></li></ol></li><li class="section"><a href="rails-flavored-ruby#sec:exercises"><span class="number">4.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="filling-in-the-layout#top"><span class="number">Chapter 5</span> Filling in the layout</a></li><li><ol><li class="section"><a href="filling-in-the-layout#sec:structure"><span class="number">5.1</span> Adding some structure</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:adding_to_the_layout"><span class="number">5.1.1</span> Site navigation</a></li><li class="subsection"><a href="filling-in-the-layout#sec:custom_css"><span class="number">5.1.2</span> Custom CSS</a></li><li class="subsection"><a href="filling-in-the-layout#sec:partials"><span class="number">5.1.3</span> Partials</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:layout_links"><span class="number">5.2</span> Layout links</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:integration_tests"><span class="number">5.2.1</span> Integration tests</a></li><li class="subsection"><a href="filling-in-the-layout#sec:rails_routes"><span class="number">5.2.2</span> Rails routes</a></li><li class="subsection"><a href="filling-in-the-layout#sec:named_routes"><span class="number">5.2.3</span> Named routes</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:user_signup"><span class="number">5.3</span> User signup: A first step</a></li><li><ol><li class="subsection"><a href="filling-in-the-layout#sec:users_controller"><span class="number">5.3.1</span> Users controller</a></li><li class="subsection"><a href="filling-in-the-layout#sec:signup_url"><span class="number">5.3.2</span> Signup URL</a></li></ol></li><li class="section"><a href="filling-in-the-layout#sec:layout_conclusion"><span class="number">5.4</span> Conclusion</a></li><li class="section"><a href="filling-in-the-layout#sec:layout_exercises"><span class="number">5.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="modeling-and-viewing-users-one#top"><span class="number">Chapter 6</span> Modeling and viewing users, part I</a></li><li><ol><li class="section"><a href="modeling-and-viewing-users-one#sec:user_model"><span class="number">6.1</span> User model</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:database_migrations"><span class="number">6.1.1</span> Database migrations</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:the_model_file"><span class="number">6.1.2</span> The model file</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:model_annotation">Model annotation</a></li><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:accessible_attributes">Accessible attributes</a></li></ol></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:creating_user_objects"><span class="number">6.1.3</span> Creating user objects</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:finding_user_objects"><span class="number">6.1.4</span> Finding user objects</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:updating_user_objects"><span class="number">6.1.5</span> Updating user objects</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:user_validations"><span class="number">6.2</span> User validations</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:presence_validation"><span class="number">6.2.1</span> Validating presence</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:length_validation"><span class="number">6.2.2</span> Length validation</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:format_validation"><span class="number">6.2.3</span> Format validation</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:uniqueness_validation"><span class="number">6.2.4</span> Uniqueness validation</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:the_caveat">The uniqueness caveat</a></li></ol></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:viewing_users"><span class="number">6.3</span> Viewing users</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-one#sec:rails_environments"><span class="number">6.3.1</span> Debug and Rails environments</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:users_show"><span class="number">6.3.2</span> User model, view, controller</a></li><li class="subsection"><a href="modeling-and-viewing-users-one#sec:a_users_resource"><span class="number">6.3.3</span> A Users resource</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-one#sec:params_in_debug"><code>params</code> in <code>debug</code></a></li></ol></li></ol></li><li class="section"><a href="modeling-and-viewing-users-one#sec:6.4"><span class="number">6.4</span> Conclusion</a></li><li class="section"><a href="modeling-and-viewing-users-one#sec:6.5"><span class="number">6.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="modeling-and-viewing-users-two#top"><span class="number">Chapter 7</span> Modeling and viewing users, part II</a></li><li><ol><li class="section"><a href="modeling-and-viewing-users-two#sec:insecure_passwords"><span class="number">7.1</span> Insecure passwords</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_validations"><span class="number">7.1.1</span> Password validations</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:password_migration"><span class="number">7.1.2</span> A password migration</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_active_record_callback"><span class="number">7.1.3</span> An Active Record callback</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:secure_passwords"><span class="number">7.2</span> Secure passwords</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_secure_password_test"><span class="number">7.2.1</span> A secure password test</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:secure_password_theory"><span class="number">7.2.2</span> Some secure password theory</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:implementing_has_password"><span class="number">7.2.3</span> Implementing <code>has_password?</code></a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:an_authenticate_method"><span class="number">7.2.4</span> An authenticate method</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:better_user_views"><span class="number">7.3</span> Better user views</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:tests_with_factories"><span class="number">7.3.1</span> Testing the user show page (with factories)</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_name_and_a_gravatar"><span class="number">7.3.2</span> A name and a Gravatar</a></li><li><ol><li class="subsubsection"><a href="modeling-and-viewing-users-two#sec:a_gravatar_helper">A Gravatar helper</a></li></ol></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:a_user_sidebar"><span class="number">7.3.3</span> A user sidebar</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:7.4"><span class="number">7.4</span> Conclusion</a></li><li><ol><li class="subsection"><a href="modeling-and-viewing-users-two#sec:7.4.1"><span class="number">7.4.1</span> Git commit</a></li><li class="subsection"><a href="modeling-and-viewing-users-two#sec:heroku_deploy"><span class="number">7.4.2</span> Heroku deploy</a></li></ol></li><li class="section"><a href="modeling-and-viewing-users-two#sec:more_modeling_users_exercises"><span class="number">7.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="sign-up#top"><span class="number">Chapter 8</span> Sign up</a></li><li><ol><li class="section"><a href="sign-up#sec:signup_form"><span class="number">8.1</span> Signup form</a></li><li><ol><li class="subsection"><a href="sign-up#sec:using_form_for"><span class="number">8.1.1</span> Using <code>form_for</code></a></li><li class="subsection"><a href="sign-up#sec:the_form_html"><span class="number">8.1.2</span> The form HTML</a></li></ol></li><li class="section"><a href="sign-up#sec:signup_failure"><span class="number">8.2</span> Signup failure</a></li><li><ol><li class="subsection"><a href="sign-up#sec:testing_failure"><span class="number">8.2.1</span> Testing failure</a></li><li class="subsection"><a href="sign-up#sec:a_working_form"><span class="number">8.2.2</span> A working form</a></li><li class="subsection"><a href="sign-up#sec:signup_error_messages"><span class="number">8.2.3</span> Signup error messages</a></li><li class="subsection"><a href="sign-up#sec:filtering_parameter_logging"><span class="number">8.2.4</span> Filtering parameter logging</a></li></ol></li><li class="section"><a href="sign-up#sec:signup_success"><span class="number">8.3</span> Signup success</a></li><li><ol><li class="subsection"><a href="sign-up#sec:testing_success"><span class="number">8.3.1</span> Testing success</a></li><li class="subsection"><a href="sign-up#sec:the_finished_signup_form"><span class="number">8.3.2</span> The finished signup form</a></li><li class="subsection"><a href="sign-up#sec:the_flash"><span class="number">8.3.3</span> The flash</a></li><li class="subsection"><a href="sign-up#sec:the_first_signup"><span class="number">8.3.4</span> The first signup</a></li></ol></li><li class="section"><a href="sign-up#sec:rspec_integration_tests"><span class="number">8.4</span> RSpec integration tests</a></li><li><ol><li class="subsection"><a href="sign-up#sec:integration_tests_with_style"><span class="number">8.4.1</span> Integration tests with style</a></li><li class="subsection"><a href="sign-up#sec:failed_signup"><span class="number">8.4.2</span> Users signup failure should not make a new user</a></li><li class="subsection"><a href="sign-up#sec:successful_signup"><span class="number">8.4.3</span> Users signup success should make a new user</a></li></ol></li><li class="section"><a href="sign-up#sec:8.5"><span class="number">8.5</span> Conclusion</a></li><li class="section"><a href="sign-up#sec:signup_exercises"><span class="number">8.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="sign-in-sign-out#top"><span class="number">Chapter 9</span> Sign in, sign out</a></li><li><ol><li class="section"><a href="sign-in-sign-out#sec:sessions"><span class="number">9.1</span> Sessions</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:sessions_controller"><span class="number">9.1.1</span> Sessions controller</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_form"><span class="number">9.1.2</span> Signin form</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signin_failure"><span class="number">9.2</span> Signin failure</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:reviewing_form_submission"><span class="number">9.2.1</span> Reviewing form submission</a></li><li class="subsection"><a href="sign-in-sign-out#sec:failed_signin"><span class="number">9.2.2</span> Failed signin (test and code)</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signin_success"><span class="number">9.3</span> Signin success</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:the_completed_create_action"><span class="number">9.3.1</span> The completed <code>create</code> action</a></li><li class="subsection"><a href="sign-in-sign-out#sec:remember_me"><span class="number">9.3.2</span> Remember me</a></li><li class="subsection"><a href="sign-in-sign-out#sec:current_user"><span class="number">9.3.3</span> Current user</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:signing_out"><span class="number">9.4</span> Signing out</a></li><li><ol><li class="subsection"><a href="sign-in-sign-out#sec:destroying_sessions"><span class="number">9.4.1</span> Destroying sessions</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_upon_signup"><span class="number">9.4.2</span> Signin upon signup</a></li><li class="subsection"><a href="sign-in-sign-out#sec:changing_the_layout_links"><span class="number">9.4.3</span> Changing the layout links</a></li><li class="subsection"><a href="sign-in-sign-out#sec:signin_out_integration_tests"><span class="number">9.4.4</span> Signin/out integration tests</a></li></ol></li><li class="section"><a href="sign-in-sign-out#sec:9.5"><span class="number">9.5</span> Conclusion</a></li><li class="section"><a href="sign-in-sign-out#sec:sign_in_out_exercises"><span class="number">9.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="updating-showing-and-deleting-users#top"><span class="number">Chapter 10</span> Updating, showing, and deleting users</a></li><li><ol><li class="section"><a href="updating-showing-and-deleting-users#sec:updating_users"><span class="number">10.1</span> Updating users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:edit_form"><span class="number">10.1.1</span> Edit form</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:enabling_edits"><span class="number">10.1.2</span> Enabling edits</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:protecting_pages"><span class="number">10.2</span> Protecting pages</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_signed_in_users"><span class="number">10.2.1</span> Requiring signed-in users</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:requiring_the_right_user"><span class="number">10.2.2</span> Requiring the right user</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:friendly_forwarding"><span class="number">10.2.3</span> Friendly forwarding</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:showing_users"><span class="number">10.3</span> Showing users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:user_index"><span class="number">10.3.1</span> User index</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:sample_users"><span class="number">10.3.2</span> Sample users</a></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:pagination"><span class="number">10.3.3</span> Pagination</a></li><li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:testing_pagination">Testing pagination</a></li></ol></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:partial_refactoring"><span class="number">10.3.4</span> Partial refactoring</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:destroying_users"><span class="number">10.4</span> Destroying users</a></li><li><ol><li class="subsection"><a href="updating-showing-and-deleting-users#sec:administrative_users"><span class="number">10.4.1</span> Administrative users</a></li><li><ol><li class="subsubsection"><a href="updating-showing-and-deleting-users#sec:revisiting_attr_accessible">Revisiting <code>attr_accessible</code></a></li></ol></li><li class="subsection"><a href="updating-showing-and-deleting-users#sec:the_destroy_action"><span class="number">10.4.2</span> The <code>destroy</code> action</a></li></ol></li><li class="section"><a href="updating-showing-and-deleting-users#sec:10.5"><span class="number">10.5</span> Conclusion</a></li><li class="section"><a href="updating-showing-and-deleting-users#sec:updating_deleting_exercises"><span class="number">10.6</span> Exercises</a></li></ol></li><li class="chapter"><a href="user-microposts#top"><span class="number">Chapter 11</span> User microposts</a></li><li><ol><li class="section"><a href="user-microposts#sec:a_micropost_model"><span class="number">11.1</span> A Micropost model</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:the_basic_model"><span class="number">11.1.1</span> The basic model</a></li><li><ol><li class="subsubsection"><a href="user-microposts#sec:accessible_attribute">Accessible attribute</a></li></ol></li><li class="subsection"><a href="user-microposts#sec:user_micropost_associations"><span class="number">11.1.2</span> User/Micropost associations</a></li><li class="subsection"><a href="user-microposts#sec:ordering_and_dependency"><span class="number">11.1.3</span> Micropost refinements</a></li><li><ol><li class="subsubsection"><a href="user-microposts#sec:default_scope">Default scope</a></li><li class="subsubsection"><a href="user-microposts#sec:dependent_destroy">Dependent: destroy</a></li></ol></li><li class="subsection"><a href="user-microposts#sec:micropost_validations"><span class="number">11.1.4</span> Micropost validations</a></li></ol></li><li class="section"><a href="user-microposts#sec:showing_microposts"><span class="number">11.2</span> Showing microposts</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:augmenting_the_user_show_page"><span class="number">11.2.1</span> Augmenting the user show page</a></li><li class="subsection"><a href="user-microposts#sec:sample_microposts"><span class="number">11.2.2</span> Sample microposts</a></li></ol></li><li class="section"><a href="user-microposts#sec:manipulating_microposts"><span class="number">11.3</span> Manipulating microposts</a></li><li><ol><li class="subsection"><a href="user-microposts#sec:access_control"><span class="number">11.3.1</span> Access control</a></li><li class="subsection"><a href="user-microposts#sec:creating_microposts"><span class="number">11.3.2</span> Creating microposts</a></li><li class="subsection"><a href="user-microposts#sec:a_proto_feed"><span class="number">11.3.3</span> A proto-feed</a></li><li class="subsection"><a href="user-microposts#sec:destroying_microposts"><span class="number">11.3.4</span> Destroying microposts</a></li><li class="subsection"><a href="user-microposts#sec:testing_the_new_home_page"><span class="number">11.3.5</span> Testing the new home page</a></li></ol></li><li class="section"><a href="user-microposts#sec:11.4"><span class="number">11.4</span> Conclusion</a></li><li class="section"><a href="user-microposts#sec:micropost_exercises"><span class="number">11.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="following-users#top"><span class="number">Chapter 12</span> Following users</a></li><li><ol><li class="section"><a href="following-users#sec:the_relationship_model"><span class="number">12.1</span> The Relationship model</a></li><li><ol><li class="subsection"><a href="following-users#sec:a_problem_with_the_data_model"><span class="number">12.1.1</span> A problem with the data model (and a solution)</a></li><li class="subsection"><a href="following-users#sec:relationship_user_associations"><span class="number">12.1.2</span> User/relationship associations</a></li><li class="subsection"><a href="following-users#sec:relationship_validations"><span class="number">12.1.3</span> Validations</a></li><li class="subsection"><a href="following-users#sec:following"><span class="number">12.1.4</span> Following</a></li><li class="subsection"><a href="following-users#sec:followers"><span class="number">12.1.5</span> Followers</a></li></ol></li><li class="section"><a href="following-users#sec:a_web_interface_for_following_and_followers"><span class="number">12.2</span> A web interface for following and followers</a></li><li><ol><li class="subsection"><a href="following-users#sec:sample_following_data"><span class="number">12.2.1</span> Sample following data</a></li><li class="subsection"><a href="following-users#sec:stats_and_a_follow_form"><span class="number">12.2.2</span> Stats and a follow form</a></li><li class="subsection"><a href="following-users#sec:following_and_followers_pages"><span class="number">12.2.3</span> Following and followers pages</a></li><li class="subsection"><a href="following-users#sec:a_working_follow_button_the_standard_way"><span class="number">12.2.4</span> A working follow button the standard way</a></li><li class="subsection"><a href="following-users#sec:a_working_follow_button_with_ajax"><span class="number">12.2.5</span> A working follow button with Ajax</a></li></ol></li><li class="section"><a href="following-users#sec:the_status_feed"><span class="number">12.3</span> The status feed</a></li><li><ol><li class="subsection"><a href="following-users#sec:motivation_and_strategy"><span class="number">12.3.1</span> Motivation and strategy</a></li><li class="subsection"><a href="following-users#sec:a_first_feed_implementation"><span class="number">12.3.2</span> A first feed implementation</a></li><li class="subsection"><a href="following-users#sec:scopes_subselects_and_a_lambda"><span class="number">12.3.3</span> Scopes, subselects, and a lambda</a></li><li class="subsection"><a href="following-users#sec:the_new_status_feed"><span class="number">12.3.4</span> The new status feed</a></li></ol></li><li class="section"><a href="following-users#sec:following_conclusion"><span class="number">12.4</span> Conclusion</a></li><li><ol><li class="subsection"><a href="following-users#sec:extensions_to_the_sample_application"><span class="number">12.4.1</span> Extensions to the sample application</a></li><li><ol><li class="subsubsection"><a href="following-users#sec:replies">Replies</a></li><li class="subsubsection"><a href="following-users#sec:messaging">Messaging</a></li><li class="subsubsection"><a href="following-users#sec:follower_notifications">Follower notifications</a></li><li class="subsubsection"><a href="following-users#sec:password_reminders">Password reminders</a></li><li class="subsubsection"><a href="following-users#sec:signup_confirmation">Signup confirmation</a></li><li class="subsubsection"><a href="following-users#sec:rss_feed">RSS feed</a></li><li class="subsubsection"><a href="following-users#sec:rest_api">REST API</a></li><li class="subsubsection"><a href="following-users#sec:search">Search</a></li></ol></li><li class="subsection"><a href="following-users#sec:guide_to_further_resources"><span class="number">12.4.2</span> Guide to further resources</a></li></ol></li><li class="section"><a href="following-users#sec:following_exercises"><span class="number">12.5</span> Exercises</a></li></ol></li><li class="chapter"><a href="rails-3-1#top"><span class="number">Chapter 13</span> Rails 3.1</a></li><li><ol><li class="section"><a href="rails-3-1#sec:upgrading_the_sample_app"><span class="number">13.1</span> Upgrading the sample app</a></li><li><ol><li class="subsection"><a href="rails-3-1#sec:installing_and_configuring_rails_3_1"><span class="number">13.1.1</span> Installing and configuring Rails&nbsp;3.1</a></li><li class="subsection"><a href="rails-3-1#sec:getting_to_red"><span class="number">13.1.2</span> Getting to Red</a></li><li class="subsection"><a href="rails-3-1#sec:minor_issues"><span class="number">13.1.3</span> Minor issues</a></li><li><ol><li class="subsubsection"><a href="rails-3-1#sec:will_paginate">will_paginate</a></li><li class="subsubsection"><a href="rails-3-1#sec:pagination_spec">Pagination spec</a></li></ol></li><li class="subsection"><a href="rails-3-1#sec:major_differences"><span class="number">13.1.4</span> Major differences</a></li><li><ol><li class="subsubsection"><a href="rails-3-1#sec:asset_directories">Asset directories</a></li><li class="subsubsection"><a href="rails-3-1#sec:prototype_to_jquery">Prototype to jQuery</a></li></ol></li></ol></li><li class="section"><a href="rails-3-1#sec:new_features"><span class="number">13.2</span> New features in Rails 3.1</a></li><li><ol><li class="subsection"><a href="rails-3-1#sec:asset_pipeline"><span class="number">13.2.1</span> Asset pipeline</a></li><li class="subsection"><a href="rails-3-1#sec:reversible_migrations"><span class="number">13.2.2</span> Reversible migrations</a></li><li class="subsection"><a href="rails-3-1#sec:sass_and_coffeescript"><span class="number">13.2.3</span> Sass and CoffeeScript</a></li></ol></li><li class="section"><a href="rails-3-1#sec:rails_3_1_exercises"><span class="number">13.3</span> Exercises</a></li></ol></li></ol></div>


<div id="main_content"></div>


<p> <span class="preamble">
 <span id="foreword">
<strong> Foreword</strong> <br />
 </span>
 </span></p>

<p>My former company (CD Baby) was one of the first to loudly switch to Ruby on Rails, and then even more loudly switch back to PHP (Google me to read about the drama). This book by Michael Hartl came so highly recommended that I had to try it, and <em>Ruby on Rails Tutorial</em> is what I used to switch back to Rails again.</p>

<p>Though I&rsquo;ve worked my way through many Rails books, this is the one that finally made me &ldquo;get&rdquo; it. Everything is done very much &ldquo;the Rails way&rdquo;&mdash;a way that felt very unnatural to me before, but now after doing this book finally feels natural. This is also the only Rails book that does test-driven development the entire time, an approach highly recommended by the experts but which has never been so clearly demonstrated before. Finally, by including Git, GitHub, and Heroku in the demo examples, the author really gives you a feel for what it&rsquo;s like to do a real-world project. The tutorial&rsquo;s code examples are not in isolation.</p>

<p>The linear narrative is such a great format. Personally, I powered through <em>Rails Tutorial</em> in three long days, doing all the examples and challenges at the end of each chapter. Do it from start to finish, without jumping around, and you&rsquo;ll get the ultimate benefit.</p>

<p>Enjoy!</p>

<p><a href="http://sivers.org/">Derek Sivers</a> (<a href="http://sivers.org/">sivers.org</a>) <br />
<em>Formerly: Founder,</em> <a href="http://www.cdbaby.com/"><em>CD Baby</em></a> <br />
<em>Currently: Founder,</em> <a href="http://thoughts.pro/"><em>Thoughts Ltd.</em></a> <br /></p>

<p> <span class="preamble">
<strong> Acknowledgments</strong> <br />
 </span></p>

<p><em>Ruby on Rails Tutorial</em> owes a lot to my previous Rails book, <em>RailsSpace</em>, and hence to my coauthor <a href="http://aure.com/">Aurelius Prochazka</a>. I&rsquo;d like to thank Aure both for the work he did on that book and for his support of this one. I&rsquo;d also like to thank Debra Williams Cauley, my editor on both <em>RailsSpace</em> and <em>Rails Tutorial</em>; as long as she keeps taking me to baseball games, I&rsquo;ll keep writing books for her.</p>

<p>I&rsquo;d like to acknowledge a long list of Rubyists who have taught and inspired me over the years: David Heinemeier Hansson, Yehuda Katz, Carl Lerche, Jeremy Kemper, Xavier Noria, Ryan Bates, Geoffrey Grosenbach, Peter Cooper, Matt Aimonetti, Gregg Pollack, Wayne&nbsp;E. Seguin, Amy Hoy, Dave Chelimsky, Pat Maddox, Tom Preston-Werner, Chris Wanstrath, Chad Fowler, Josh Susser, Obie Fernandez, Ian McFarland, Steven Bristol, Wolfram Arnold, Alex Chaffee, Giles Bowkett, Evan Dorn, Long Nguyen, James Lindenbaum, Adam Wiggins, Tikhon Bernstam, Ron Evans, Wyatt Greene, Miles Forrest, the good people at Pivotal Labs, the Heroku gang, the thoughtbot guys, and the GitHub crew. Finally, many, many readers&mdash;far too many to list&mdash;have contributed a huge number of bug reports and suggestions during the writing of this book, and I gratefully acknowledge their help in making it as good as it can&nbsp;be. <br /></p>

<p> <span class="preamble">
 <span id="author">
<strong> About the author</strong> <br />
 </span>
 </span></p>

<p><a href="http://michaelhartl.com/">Michael Hartl</a> is a programmer, educator, and entrepreneur. Michael was coauthor of <em>RailsSpace</em>, a best-selling Rails tutorial book published in 2007, and was cofounder and lead developer of <a href="http://insoshi.com/">Insoshi</a>, a <a href="http://github.com/popular/forked">popular</a> social networking platform in Ruby on Rails. Previously, he taught theoretical and computational physics at the <a href="http://www.caltech.edu/">California Institute of Technology</a> (Caltech), where he received the Lifetime Achievement Award for Excellence in Teaching. Michael is a graduate of <a href="http://college.harvard.edu/">Harvard College</a>, has a <a href="http://resolver.caltech.edu/CaltechETD:etd-05222003-161626">Ph.D. in Physics</a> from <a href="http://www.caltech.edu/">Caltech</a>, and is an alumnus of the <a href="http://ycombinator.com/">Y&nbsp;Combinator</a> entrepreneur program. <br /></p>

<p> <span id="license" class="preamble">
<strong> Copyright and license</strong> <br />
 </span></p>

<p><em>Ruby on Rails Tutorial: Learn Rails by Example</em>. Copyright &copy; 2010 by Michael Hartl. All source code in <em>Ruby on Rails Tutorial</em> is available under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a> and the <a href="http://en.wikipedia.org/wiki/Beerware">Beerware License</a>.</p>

<pre class="verbatim">   Copyright (c) 2010 Michael Hartl

   Permission is hereby granted, free of charge, to any person
   obtaining a copy of this software and associated documentation
   files (the &quot;Software&quot;), to deal in the Software without
   restriction, including without limitation the rights to use,
   copy, modify, merge, publish, distribute, sublicense, and/or sell
   copies of the Software, and to permit persons to whom the
   Software is furnished to do so, subject to the following
   conditions:

   The above copyright notice and this permission notice shall be
   included in all copies or substantial portions of the Software.

   THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
   EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
   OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
   NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
   HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
   WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
   FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
   OTHER DEALINGS IN THE SOFTWARE.</pre>




<pre class="verbatim">/*
 * ------------------------------------------------------------
 * &quot;THE BEERWARE LICENSE&quot; (Revision 42):
 * Michael Hartl wrote this code. As long as you retain this 
 * notice, you can do whatever you want with this stuff. If we
 * meet someday, and you think this stuff is worth it, you can
 * buy me a beer in return.
 * ------------------------------------------------------------
 */</pre>




<div id="top"></div>


<h1 class="chapter"><a id="sec:3" href="static-pages#top" class="heading"><span class="number">Chapter 3</span> Mostly static pages</a></h1>


<p>In this chapter, we will begin developing the sample application that will serve as our example throughout the rest of this tutorial. Although the sample app will eventually have users, microposts, and a full login and authentication framework, we will begin with a seemingly limited topic: the creation of static pages. Despite its apparent simplicity, making static pages is a highly instructive exercise, rich in implications&mdash;a perfect start for our nascent application.</p>

<p>Although Rails is designed for making database-backed dynamic websites, it also excels at making the kind of static pages we might make with raw HTML files. In fact, using Rails even for static pages yields a distinct advantage: we can easily add just a <em>small</em> amount of dynamic content. In this chapter we&rsquo;ll learn how. Along the way, we&rsquo;ll get our first taste of <em>automated testing</em>, which will help us be more confident that our code is correct. Moreover, having a good test suite will allow us to <em>refactor</em> our code with confidence, changing its form without changing its function.</p>

<p>As in <a class="ref" href="a-demo-app#top">Chapter&nbsp;2</a>, before getting started we need to create a new Rails project, this time called <tt>sample_app</tt>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new sample_app -T
<span class="gp">$</span> <span class="nb">cd </span>sample_app
</pre></div>
</div>


<p>Here the <code>-T</code> option to the <code>rails</code> command tells Rails not to generate a <code>test</code> directory associated with the default <tt>Test::Unit</tt> framework. This is not because we won&rsquo;t be writing tests; on the contrary, starting in <a class="ref" href="static-pages#sec:first_tests">Section&nbsp;3.2</a> we will be using an alternate testing framework called <em>RSpec</em> to write a thorough test suite.</p>

<p>As in <a class="ref" href="a-demo-app#sec:planning_the_application">Section&nbsp;2.1</a>, our next step is to use a text editor to update the <code>Gemfile</code> with the gems needed by our application. (Recall that you might need version <tt>1.2.5</tt> of the <tt>sqlite3</tt> gem, depending on your system.) On the other hand, for the sample application we&rsquo;ll also need two gems we didn&rsquo;t need before: the gem for RSpec and the gem for the RSpec library specific to Rails. The code to include them is shown in <a class="ref" href="static-pages#code:gemfile_rspec">Listing&nbsp;3.1</a>. (<em>Note</em>: If you would like to install <em>all</em> the gems needed for the sample application, you should use the code in <a class="ref" href="updating-showing-and-deleting-users#code:final_gemfile">Listing&nbsp;10.42</a> at this time.)</p>

<div class="label" id="code:gemfile_rspec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.1.</span> <span class="description">A <code>Gemfile</code> for the sample app.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.9&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.3&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.6.1&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.6.1&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;webrat&#39;</span><span class="p">,</span> <span class="s1">&#39;0.7.1&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>This includes <tt>rspec-rails</tt> in development mode so that we have access to RSpec-specific generators, and it includes it in test mode in order to run the tests. (We also include a gem for <a href="http://github.com/brynary/webrat">Webrat</a>, a testing utility which used to be installed automatically as a dependency but now needs to be included explicitly.) To install and include the RSpec gems, we use <code>bundle install</code> as usual:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>In order to get Rails to use RSpec in place of <tt>Test::Unit</tt>, we need to install the files needed by RSpec. This can be accomplished with <code>rails generate</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate rspec:install
</pre></div>
</div>


<p>With that, all we have left is to initialize the Git repository:<sup class="footnote" id="fnref:3.1"><a href="#fn:3.1">1</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<p>As with the first application, I suggest updating the <code>README</code> file (located in the root directory of the application) to be more helpful and descriptive, as shown in <a class="ref" href="static-pages#code:sample_app_readme">Listing&nbsp;3.2</a>.</p>

<div class="label" id="code:sample_app_readme"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.2.</span> <span class="description">An improved <code>README</code> file for the sample app.</span>       
</div>
<div class="code"><div class="highlight"><pre># Ruby on Rails Tutorial: sample application

This is the sample application for
[*Ruby on Rails Tutorial: Learn Rails by Example*](http://railstutorial.org/)
by [Michael Hartl](http://michaelhartl.com/).
</pre></div>
</div></div>


<p>Then change it to use the <code>markdown</code> extension and commit the changes:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git mv README README.markdown
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Improved the README&quot;</span>
</pre></div>
</div>




<div class="label" id="fig:create_repository"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_repository.png" alt="create_repository" /></span></div><div class="caption"><span class="header">Figure 3.1: </span><span class="description">Creating the sample app repository at GitHub.&nbsp;<a href="http://railstutorial.org/images/figures/create_repository-full.png">(full size)</a></span></div></div>


<p>Since we&rsquo;ll be using this sample app throughout the rest of the book, it&rsquo;s a good idea to make a repository at GitHub (<a class="ref" href="static-pages#fig:create_repository">Figure&nbsp;3.1</a>) and push it up:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/sample_app.git
<span class="gp">$</span> git push origin master
</pre></div>
</div>


<p>(Note that, as a result of this step, the repository at <a href="http://github.com/railstutorial/sample_app">http://github.com/railstutorial/sample_app</a> has the source code for the full sample application. You are welcome to consult it for reference, with two caveats: (1) You will learn a lot more if you type in the source code samples yourself, rather than relying on the completed version; (2) There may be minor differences between the GitHub repository and the code in the book. This is due both to the incorporation of some of the book&rsquo;s exercises and to the repository&rsquo;s use in the <a href="http://railstutorial.org/screencasts">Rails Tutorial screencasts</a>, which includes a few more tests.)</p>

<p>Of course, we can optionally deploy the app to Heroku even at this early stage:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create
<span class="gp">$</span> git push heroku master
</pre></div>
</div>


<p>(If this doesn&rsquo;t work for you, see the note just above <a class="ref" href="beginning#code:gemfile_sqlite_heroku">Listing&nbsp;1.9</a> for a possible fix.) As you proceed through the rest of the book, I recommend pushing and deploying the application regularly:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git push
<span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>With that, we&rsquo;re ready to get started developing the sample application.</p>

<div class="label" id="sec:static_pages"></div>


<h2><a id="sec:3.1" href="static-pages#sec:static_pages" class="heading"><span class="number">3.1</span> Static pages</a></h2>


<p>Rails has two main ways of making static web pages. First, Rails can handle <em>truly</em> static pages consisting of raw HTML files. Second, Rails allows us to define <em>views</em> containing raw HTML, which Rails can <em>render</em> so that the web server can send it to the browser.</p>

<p>In order to get our bearings, it&rsquo;s helpful to recall the Rails directory structure from <a class="ref" href="beginning#sec:the_first_application">Section&nbsp;1.2.3</a> (<a class="ref" href="beginning#fig:directory_structure_rails_3">Figure&nbsp;1.2</a>). In this section, we&rsquo;ll be working mainly in the <code>app/controllers</code> and <code>app/views</code> directories. (In <a class="ref" href="static-pages#sec:first_tests">Section&nbsp;3.2</a>, we&rsquo;ll even add a new directory of our own.)</p>

<div class="label" id="sec:truly_static_pages"></div>


<h3><a id="sec:3.1.1" href="static-pages#sec:truly_static_pages" class="heading"><span class="number">3.1.1</span> Truly static pages</a></h3>


<p>We start with truly static pages. Recall from <a class="ref" href="beginning#sec:rails_server">Section&nbsp;1.2.5</a> that every Rails application comes with a minimal working application thanks to the <code>rails</code> script, with a default welcome page at the address <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> (<a class="ref" href="beginning#fig:riding_rails_3">Figure&nbsp;1.3</a>).</p>

<div class="label" id="fig:public_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/public_index_rails_3.png" alt="public_index_rails_3" /></span></div><div class="caption"><span class="header">Figure 3.2: </span><span class="description">The <code>public/index.html</code> file.&nbsp;<a href="http://railstutorial.org/images/figures/public_index_rails_3-full.png">(full size)</a></span></div></div>


<p>To learn where this page comes from, take a look at the file <code>public/index.html</code> (<a class="ref" href="static-pages#fig:public_index_rails_3">Figure&nbsp;3.2</a>). Because the file contains its own stylesheet information, it&rsquo;s a little messy, but it gets the job done: by default, Rails serves any files in the <code>public</code> directory directly to the browser.<sup class="footnote" id="fnref:3.2"><a href="#fn:3.2">2</a></sup> In the case of the special <code>index.html</code> file, you don&rsquo;t even have to indicate the file in the URL, as <code>index.html</code> is the default. You can include it if you want, though; the addresses</p>

<pre class="verbatim">http://localhost:3000/</pre>


<p>and</p>

<pre class="verbatim">http://localhost:3000/index.html</pre>


<p>are equivalent.</p>

<p>As you might expect, if we want we can make our own static HTML files and put them in the same <code>public</code> directory as <code>index.html</code>. For example, let&rsquo;s create a file with a friendly greeting (<a class="ref" href="static-pages#code:hello_world">Listing&nbsp;3.3</a>):<sup class="footnote" id="fnref:3.3"><a href="#fn:3.3">3</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate public/hello.html
</pre></div>
</div>


<div class="label" id="code:hello_world"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.3.</span> <span class="description">A typical HTML file, with a friendly greeting. <br /> <code>public/hello.html</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Greeting<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;p&gt;</span>Hello, world!<span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>We see in <a class="ref" href="static-pages#code:hello_world">Listing&nbsp;3.3</a> the typical structure of an HTML document: a <em>document type</em>, or doctype, declaration at the top to tell browsers which version of HTML we&rsquo;re using (in this case, <a href="http://en.wikipedia.org/wiki/HTML5">HTML5</a>);<sup class="footnote" id="fnref:3.4"><a href="#fn:3.4">4</a></sup> a <code>head</code> section, in this case with &ldquo;Greeting&rdquo; inside a <code>title</code> tag; and a <code>body</code> section, in this case with &ldquo;Hello, world!&rdquo; inside a <code>p</code> (paragraph) tag. (The indentation is optional&mdash;HTML is not sensitive to whitespace, and ignores both tabs and spaces&mdash;but it makes the document&rsquo;s structure easier to see.) As promised, when visiting the address <a href="http://localhost:3000/hello.html"><tt>http://localhost:3000/hello.html</tt></a>,  Rails renders it straightaway (<a class="ref" href="static-pages#fig:hello_world">Figure&nbsp;3.3</a>). Note that the title displayed at the top of the browser window in <a class="ref" href="static-pages#fig:hello_world">Figure&nbsp;3.3</a> is just the contents inside the <code>title</code> tag, namely, &ldquo;Greeting&rdquo;.</p>

<div class="label" id="fig:hello_world"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/hello_world.png" alt="hello_world" /></span></div><div class="caption"><span class="header">Figure 3.3: </span><span class="description">Our very own static HTML file (<a href="http://localhost:3000/hello.html"><tt>http://localhost:3000/hello.html</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/hello_world-full.png">(full size)</a></span></div></div>


<p>Since this file is just for demonstration purposes, we don&rsquo;t really want it to be part of our sample application, so it&rsquo;s probably best to remove it once the thrill of creating it has worn off:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm public/hello.html
</pre></div>
</div>


<p>We&rsquo;ll leave the <code>index.html</code> file alone for now, but of course eventually we should remove it: we don&rsquo;t want the root of our application to be the Rails default page shown in <a class="ref" href="beginning#fig:riding_rails_3">Figure&nbsp;1.3</a>. We&rsquo;ll see in <a class="ref" href="filling-in-the-layout#sec:layout_links">Section&nbsp;5.2</a> how to change the address <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> to point to something other than <code>public/index.html</code>.</p>

<div class="label" id="sec:static_pages_with_rails"></div>


<h3><a id="sec:3.1.2" href="static-pages#sec:static_pages_with_rails" class="heading"><span class="number">3.1.2</span> Static pages with Rails</a></h3>


<p>The ability to return static HTML files is nice, but it&rsquo;s not particularly useful for making dynamic web applications. In this section, we&rsquo;ll take a first step toward making dynamic pages by creating a set of Rails <em>actions</em>, which are a more powerful way to define URLs than static files.<sup class="footnote" id="fnref:3.5"><a href="#fn:3.5">5</a></sup> Rails actions come bundled together inside <em>controllers</em> (the C in MVC from <a class="ref" href="beginning#sec:mvc">Section&nbsp;1.2.6</a>), which contain sets of actions related by a common purpose. We got a glimpse of controllers in <a class="ref" href="a-demo-app#top">Chapter&nbsp;2</a>, and will come to a deeper understanding once we explore the <a href="http://en.wikipedia.org/wiki/Representational_State_Transfer">REST architecture</a> more fully (starting in <a class="ref" href="modeling-and-viewing-users-one#top">Chapter&nbsp;6</a>); in essence, a controller is a container for a group of (possibly dynamic) web pages.</p>

<p>To get started, recall from <a class="ref" href="beginning#sec:git_commands">Section&nbsp;1.3.5</a> that, when using Git, it&rsquo;s a good practice to do our work on a separate topic branch rather than the master branch. If you&rsquo;re using Git for version control, you should run the following command:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout -b static-pages
</pre></div>
</div>


<p>Rails comes with a script for making controllers called <code>generate</code>; all it needs to work its magic is the controller&rsquo;s name. Since we&rsquo;re making this controller to handle (mostly) static pages, we&rsquo;ll just call it the Pages controller, and plan to make actions for a Home page, a Contact page, and an About page. The <code>generate</code> script takes an optional list of actions, so we&rsquo;ll include some of our initial actions directly on the command line:</p>

<div class="label" id="code:generating_pages"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.4.</span> <span class="description">Generating a Pages controller.</span> </div>
<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate controller Pages home contact
<span class="go">      create  app/controllers/pages_controller.rb</span>
<span class="go">       route  get &quot;pages/contact&quot;</span>
<span class="go">       route  get &quot;pages/home&quot;</span>
<span class="go">      invoke  erb</span>
<span class="go">      create    app/views/pages</span>
<span class="go">      create    app/views/pages/home.html.erb</span>
<span class="go">      create    app/views/pages/contact.html.erb</span>
<span class="go">      invoke  rspec</span>
<span class="go">      create    spec/controllers/pages_controller_spec.rb</span>
<span class="go">      create    spec/views/pages</span>
<span class="go">      create    spec/views/pages/home.html.erb_spec.rb</span>
<span class="go">      create    spec/views/pages/contact.html.erb_spec.rb</span>
<span class="go">      invoke  helper</span>
<span class="go">      create    app/helpers/pages_helper.rb</span>
<span class="go">      invoke    rspec</span>
</pre></div>
</div></div>


<p>(Note that, because we installed RSpec with <code>rails generate rspec:install</code>, the controller generation automatically creates RSpec test files in the <code>spec/</code> directory.) Here, I&rsquo;ve intentionally &ldquo;forgotten&rdquo; the <code>about</code> page so that we can see how to add it in by hand (<a class="ref" href="static-pages#sec:first_tests">Section&nbsp;3.2</a>).</p>

<p>The Pages controller generation in <a class="ref" href="static-pages#code:generating_pages">Listing&nbsp;3.4</a> automatically updates the <em>routes</em> file, called <code>config/routes.rb</code>, which Rails uses to find the correspondence between URLs and web pages. This is our first encounter with the <code>config</code> directory, so it&rsquo;s helpful to take a quick look at it (<a class="ref" href="static-pages#fig:config_directory_rails_3">Figure&nbsp;3.4</a>). The <code>config</code> directory is where Rails collects files needed for the application configuration&mdash;hence the name.</p>

<div class="label" id="fig:config_directory_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/config_directory_rails_3.png" alt="config_directory_rails_3" /></span></div><div class="caption"><span class="header">Figure 3.4: </span><span class="description">Contents of the sample app&rsquo;s <code>config</code> directory.&nbsp;<a href="http://railstutorial.org/images/figures/config_directory_rails_3-full.png">(full size)</a></span></div></div>


<p>Since we generated <code>home</code> and <code>contact</code> actions, the routes file already has a rule for each one, as seen in <a class="ref" href="static-pages#code:pages_routes">Listing&nbsp;3.5</a>.</p>

<div class="label" id="code:pages_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.5.</span> <span class="description">The routes for the <code>home</code> and <code>contact</code> actions in the Pages controller. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">SampleApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/contact&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Here the rule</p>

<div class="code"><div class="highlight"><pre><span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
</pre></div>
</div>


<p>maps requests for the URL <tt>/pages/home</tt> to the <code>home</code> action in the Pages controller. Moreover, by using <code>get</code> we arrange for the route to respond to a <tt>GET</tt> request, which is one of the fundamental
<em>HTTP verbs</em> supported by the hypertext transfer protocol (<a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>). In our case, this means that when we generate a <code>home</code> action inside the Pages controller we automatically get a page at the address <tt>/pages/home</tt>. To see the results, kill the server by hitting Ctrl-C, run <code>rails server</code>, and then navigate to <a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a> (<a class="ref" href="static-pages#fig:raw_home_view">Figure&nbsp;3.5</a>).</p>

<div class="label" id="fig:raw_home_view"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/raw_home_view.png" alt="raw_home_view" /></span></div><div class="caption"><span class="header">Figure 3.5: </span><span class="description">The raw home view (<a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a>) generated by Rails.&nbsp;<a href="http://railstutorial.org/images/figures/raw_home_view-full.png">(full size)</a></span></div></div>




<div class="label" id="sidebar:get_etc"></div>


<div class="sidebar"><span class="title"><span class="header">Box 3.1.</span><span class="description"><tt>GET</tt>, et cet.</span></span>
<p>The hypertext transfer protocol (<a href="http://en.wikipedia.org/wiki/Hypertext_Transfer_Protocol#Request_methods">HTTP</a>) defines four basic operations, corresponding to the four verbs <em>get</em>, <em>post</em>, <em>put</em>, and <em>delete</em>. These refer to operations between a <em>client</em> computer (typically running a web browser such as Firefox or Safari) and a <em>server</em> (typically running a web server such as Apache or Nginx). (It&rsquo;s important to understand that, when developing Rails applications on a local computer, the client and server are the same physical machine, but in general they are different.) An emphasis on HTTP verbs is typical of web frameworks (including Rails) influenced by the <em>REST architecture</em>, which we saw briefly in <a class="ref" href="a-demo-app#top">Chapter&nbsp;2</a> and will start learning about more in <a class="ref" href="sign-up#top">Chapter&nbsp;8</a>.</p>

<p><tt>GET</tt> is the most common HTTP operation, used for <em>reading</em> data on the web; it just means &ldquo;get a page&rdquo;, and every time you visit a site like google.com or craigslist.org your browser is submitting a <tt>GET</tt> request. <tt>POST</tt> is the next most common operation; it is the request sent by your browser when you submit a form. In Rails applications, <tt>POST</tt> requests are typically used for <em>creating</em> things (although HTTP also allows <tt>POST</tt> to perform updates); for example, the <tt>POST</tt> request sent when you submit a registration form creates a new user on the remote site. The other two verbs, <tt>PUT</tt> and <tt>DELETE</tt>, are designed for <em>updating</em> and <em>destroying</em> things on the remote server. These requests are less common than <tt>GET</tt> and <tt>POST</tt> since browsers are incapable of sending them natively, but some web frameworks (including Ruby on Rails) have clever ways of making it <em>seem</em> like browsers are issuing such requests.</p>
</div>


<p>To understand where this page comes from, let&rsquo;s start by taking a look at the Pages controller in a text editor; you should see something like <a class="ref" href="static-pages#code:pages_controller">Listing&nbsp;3.6</a>. (You may note that, unlike the demo Users and Microposts controllers from <a class="ref" href="a-demo-app#top">Chapter&nbsp;2</a>, the Pages controller does not follow the REST conventions.)</p>

<div class="label" id="code:pages_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.6.</span> <span class="description">The Pages controller made by <a class="ref" href="static-pages#code:generating_pages">Listing&nbsp;3.4</a>. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>We see here that <code>pages_controller.rb</code> defines a <em>class</em> called <code>PagesController</code>. Classes are simply a convenient way to organize <em>functions</em> (also called <em>methods</em>) like the <code>home</code> and <code>contact</code> actions, which are defined using the <code>def</code> keyword. The angle bracket&nbsp;<code>&lt;</code> indicates that <code>PagesController</code> <em>inherits</em> from the Rails class <code>ApplicationController</code>; as we&rsquo;ll see momentarily, this means that our pages come equipped with a large amount of Rails-specific functionality. (We&rsquo;ll learn more about both classes and inheritance in <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">Section&nbsp;4.4</a>.)</p>

<p>In the case of the Pages controller, both its methods are initially empty:</p>

<div class="code"><div class="highlight"><pre><span class="k">def</span> <span class="nf">home</span>
<span class="k">end</span>

<span class="k">def</span> <span class="nf">contact</span>
<span class="k">end</span>
</pre></div>
</div>


<p>In plain Ruby, these methods would simply do nothing. In Rails, the situation is different; <code>PagesController</code> is a Ruby class, but because it inherits from <code>ApplicationController</code> the behavior of its methods is specific to Rails: when visiting the URL <tt>/pages/home</tt>, Rails looks in the Pages controller and executes the code in the <code>home</code> action, and then renders the <em>view</em> (the V in MVC from <a class="ref" href="beginning#sec:mvc">Section&nbsp;1.2.6</a>) corresponding to the action. In the present case, the <code>home</code> action is empty, so all hitting <tt>/pages/home</tt> does is render the view. So, what does a view look like, and how do we find it?</p>

<p>If you take another look at the output in <a class="ref" href="static-pages#code:generating_pages">Listing&nbsp;3.4</a>, you might be able to guess the correspondence between actions and views: an action like <code>home</code> has a corresponding view called <code>home.html.erb</code>. We&rsquo;ll learn in <a class="ref" href="static-pages#sec:slightly_dynamic_pages">Section&nbsp;3.3</a> what the <code>.erb</code> part means; from the <code>.html</code> part you probably won&rsquo;t be surprised that it basically looks like HTML (<a class="ref" href="static-pages#code:raw_home_view">Listing&nbsp;3.7</a>).</p>

<div class="label" id="code:raw_home_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.7.</span> <span class="description">The generated view for the Home page. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#home<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/home.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>The view for the <code>contact</code> action is analogous (<a class="ref" href="static-pages#code:raw_contact_view">Listing&nbsp;3.8</a>).</p>

<div class="label" id="code:raw_contact_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.8.</span> <span class="description">The generated view for the Contact page. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/contact.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Both of these views are just placeholders: they have a top-level heading (inside the <code>h1</code> tag) and a paragraph (<code>p</code> tag) with the full path to the relevant file. We&rsquo;ll add some (very slightly) dynamic content starting in <a class="ref" href="static-pages#sec:slightly_dynamic_pages">Section&nbsp;3.3</a>, but as they stand these views underscore an important point: Rails views can simply contain static HTML. As far as the browser is concerned, the raw HTML files from <a class="ref" href="static-pages#sec:truly_static_pages">Section&nbsp;3.1.1</a> and the controller/action method of delivering pages are indistinguishable: all the browser ever sees is HTML.</p>

<p>In the remainder of this chapter, we&rsquo;ll first add the <code>about</code> action we &ldquo;forgot&rdquo; in <a class="ref" href="static-pages#sec:static_pages_with_rails">Section&nbsp;3.1.2</a>, add a very small amount of dynamic content, and then take the first steps toward styling the pages with CSS. Before moving on, if you&rsquo;re using Git it&rsquo;s a good idea to add the files for the Pages controller to the repository at this time:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Added a Pages controller&quot;</span>
</pre></div>
</div>




<div class="label" id="sec:first_tests"></div>


<h2><a id="sec:3.2" href="static-pages#sec:first_tests" class="heading"><span class="number">3.2</span> Our first tests</a></h2>


<p>If you ask five Rails developers how to test any given piece of code, you&rsquo;ll get about fifteen different answers&mdash;but they&rsquo;ll all agree that you should definitely be writing tests. It&rsquo;s in this spirit that we&rsquo;ll approach testing our sample application, writing solid tests without worrying too much about making them perfect. You shouldn&rsquo;t take the tests in <em>Rails Tutorial</em> as gospel; they are based on the style I have developed during my own work and from reading the code of others. As you gain experience as a Rails developer, you will no doubt form your own preferences and develop your own testing style.</p>

<p>In addition to writing tests throughout the development of the sample application, we will also make the increasingly common choice about <em>when</em> to write tests by writing them <em>before</em> the application code&mdash;an approach known as <em>test-driven development</em>, or TDD.<sup class="footnote" id="fnref:3.6"><a href="#fn:3.6">6</a></sup> Our specific example will be to add an About page to our sample site. Fortunately, adding the extra page is not hard&mdash;you might even be able to guess the answer based on the examples in the previous section&mdash;which means that we can focus on testing, which contains quite a few new ideas.</p>

<p>At first, testing for the existence of a page might seem like overkill, but experience shows that it is not. So many things can go wrong when writing software that having a good test suite is invaluable to assure quality. Moreover, it is common for computer programs&mdash;and especially web applications&mdash;to be constantly extended, and any time you make a change you risk introducing errors. Writing tests doesn&rsquo;t guarantee that these bugs won&rsquo;t happen, but it makes them much more likely to be caught (and fixed) when they occur. Furthermore, by writing tests for bugs that <em>do</em> happen, we can make them much less likely to recur.</p>

<p>(As noted in <a class="ref" href="beginning#sec:comments_for_various_readers">Section&nbsp;1.1.1</a>, if you find the tests overwhelming, go ahead and skip them on first reading. Once you have a stronger grasp of Rails and Ruby, you can loop back and learn testing on a second pass.)</p>

<div class="label" id="sec:testing_tools"></div>


<h3><a id="sec:3.2.1" href="static-pages#sec:testing_tools" class="heading"><span class="number">3.2.1</span> Testing tools</a></h3>


<p>To write tests for our sample application, our main tool is a framework called <a href="http://rspec.info/">RSpec</a>, which is a <a href="http://en.wikipedia.org/wiki/Domain_Specific_Language"><em>domain-specific language</em></a> for describing the behavior of code, together with a program (called <code>rspec</code>) to verify the desired behavior. Designed for testing any Ruby program, RSpec has gained significant traction in the Rails community. Obie Fernandez, author of <a href="http://www.amazon.com/gp/product/0321601661?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321601661"><em>The Rails&nbsp;3 Way</em></a>, has called RSpec &ldquo;the Rails Way&rdquo;, and I agree.<sup class="footnote" id="fnref:3.7"><a href="#fn:3.7">7</a></sup></p>

<p>If you followed the steps in the introduction, RSpec has already been installed via the Bundler <code>Gemfile</code> (<a class="ref" href="static-pages#code:gemfile_rspec">Listing&nbsp;3.1</a>) and <code>bundle install</code>.</p>

<div class="label" id="sec:autotest"></div>


<h4><a id="sec:3.2.1.1" href="static-pages#sec:autotest" class="heading">Autotest</a></h4>


<p>Autotest is a tool that continuously runs your test suite in the background based on the specific file changes you make. For example, if you change a controller file, Autotest runs the tests for that controller. The result is instant feedback on the status of your tests. We&rsquo;ll learn more about Autotest when we see it in action (<a class="ref" href="static-pages#sec:TDD">Section&nbsp;3.2.2</a>).</p>

<p>Installing Autotest is optional, and configuring it can be a bit tricky, but if you can get it to work on your system I&rsquo;m sure you&rsquo;ll find it as useful as I do. To install Autotest, install the <tt>autotest</tt> and <tt>autotest-rails-pure</tt><sup class="footnote" id="fnref:3.8"><a href="#fn:3.8">8</a></sup> gems as follows:<sup class="footnote" id="fnref:3.9"><a href="#fn:3.9">9</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest -v 4.4.6
<span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-rails-pure -v 4.1.2
</pre></div>
</div>


<p>The next steps depend on your platform. I&rsquo;ll go through the steps for OS&nbsp;X, since that&rsquo;s what I use, and then give references to blog posts that discuss Autotest on Linux and Windows. On OS&nbsp;X, you should <a href="http://growl.info/">install Growl</a> (if you don&rsquo;t have it already) and then install the <tt>autotest-fsevent</tt> and <tt>autotest-growl</tt> gems:<sup class="footnote" id="fnref:3.10"><a href="#fn:3.10">10</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-fsevent -v 0.2.4
<span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install autotest-growl -v 0.2.9
</pre></div>
</div>


<p>If FSEvent won&rsquo;t install properly, double-check that <a href="http://developer.apple.com/technologies/tools/xcode.html">Xcode</a> is installed on your system.</p>

<p>To use the Growl and FSEvent gems, make an Autotest configuration file in your Rails root directory and fill it with the contents of <a class="ref" href="static-pages#code:dot_autotest">Listing&nbsp;3.9</a> (or <a class="ref" href="static-pages#code:dot_autotest_alt">Listing&nbsp;3.10</a> if <a class="ref" href="static-pages#code:dot_autotest">Listing&nbsp;3.9</a> gives an error on your system):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate .autotest
</pre></div>
</div>


<div class="label" id="code:dot_autotest"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.9.</span> <span class="description">The <code>.autotest</code> configuration file for Autotest on OS&nbsp;X.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;autotest/growl&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;autotest/fsevent&#39;</span>
</pre></div>
</div></div>




<div class="label" id="code:dot_autotest_alt"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.10.</span> <span class="description">An alternate <code>.autotest</code> file needed on some systems.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;autotest-growl&#39;</span>
<span class="nb">require</span> <span class="s1">&#39;autotest-fsevent&#39;</span>
</pre></div>
</div></div>


<p>(Note: this will create an Autotest configuration for the sample application only; if you want to share this Autotest configuration with other Rails or Ruby projects, you should create the <code>.autotest</code> file in your <em>home</em> directory instead:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> mate ~/.autotest
</pre></div>
</div>


<p>where <tt class="verb">~</tt> (tilde) is the Unix symbol for &ldquo;home directory&rdquo;.)</p>

<p>If you&rsquo;re running Linux with the Gnome desktop, you should try the steps at <a href="http://automate-everything.com/2009/08/gnome-and-autospec-notifications/">Automate Everything</a>, which sets up on Linux a system similar to Growl notifications on OS&nbsp;X. Windows users should try installing <a href="http://www.growlforwindows.com/gfw/">Growl for Windows</a> and then follow the instructions at the <a href="http://github.com/svoop/autotest-growl">GitHub page for <code>autotest-growl</code></a>. Both Linux and Windows users might want to take a look at <a href="http://github.com/carlosbrando/autotest-notification">autotest-notification</a>; <em>Rails Tutorial</em> reader Fred Schoeneman has a write-up <a href="http://fredschoeneman.posterous.com/pimp-your-autotest-notification">about Autotest notification on his blog</a>.<sup class="footnote" id="fnref:3.11"><a href="#fn:3.11">11</a></sup></p>

<div class="label" id="sec:TDD"></div>


<h3><a id="sec:3.2.2" href="static-pages#sec:TDD" class="heading"><span class="number">3.2.2</span> TDD: Red, Green, Refactor</a></h3>


<p>In test-driven development, we first write a <em>failing</em> test: in our case, a piece of code that expresses the idea that there &ldquo;should be an <code>about</code>&rdquo; page. Then we get the test to pass, in our case by adding the <code>about</code> action and corresponding view. The reason we don&rsquo;t typically do the reverse&mdash;implement first, then test&mdash;is to make sure that we actually test for the feature we&rsquo;re adding. Before I started using TDD, I was amazed to discover how often my &ldquo;tests&rdquo; actually tested the wrong thing, or even tested nothing at all. By making sure that the test fails first and <em>then</em> passes, we can be more confident that the test is doing the right thing.</p>

<p>It&rsquo;s important to understand that TDD is not always the right tool for the job. In particular, when you aren&rsquo;t at all sure how to solve a given programming problem, it&rsquo;s often useful to skip the tests and write only application code, just to get a sense of what the solution will look like. (In the language of <a href="http://en.wikipedia.org/wiki/Extreme_Programming">Extreme Programming (XP)</a>, this exploratory step is called a <em>spike</em>.) Once you see the general shape of the solution, you can then use TDD to implement a more polished version.</p>

<p>One way to proceed in test-driven development is a cycle known as &ldquo;Red, Green, Refactor&rdquo;. The first step, Red, refers to writing a failing test, which many test tools indicate with the color red. The next step, Green, refers to a passing test, indicated with the color (wait for it) green. Once we have a passing test (or set of tests), we are free to <em>refactor</em> our code, changing the form (eliminating duplication, for example) without changing the function.</p>

<p>We don&rsquo;t have any colors yet, so let&rsquo;s get started toward Red. RSpec (and testing in general) can be a little intimidating at first, so we&rsquo;ll use the tests generated by <code>rails generate controller Pages</code> in <a class="ref" href="static-pages#code:generating_pages">Listing&nbsp;3.4</a> to get us started. Since I&rsquo;m not partial to separate tests for views or helpers, which I&rsquo;ve found to be either brittle or redundant, our first step is to remove them. If you&rsquo;re using Git, you can do this as follows:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git rm -r spec/views
<span class="gp">$</span> git rm -r spec/helpers
</pre></div>
</div>


<p>Otherwise, remove them directly:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm -rf spec/views
<span class="gp">$</span> rm -rf spec/helpers
</pre></div>
</div>


<p>We&rsquo;ll handle tests for views and helpers directly in the controller tests starting in <a class="ref" href="static-pages#sec:slightly_dynamic_pages">Section&nbsp;3.3</a>.</p>

<p>To get started with RSpec, take a look at the Pages controller spec<sup class="footnote" id="fnref:3.12"><a href="#fn:3.12">12</a></sup> we just generated (<a class="ref" href="static-pages#code:default_pages_controller_spec">Listing&nbsp;3.11</a>).</p>

<div class="label" id="code:default_pages_controller_spec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.11.</span> <span class="description">The generated Pages controller spec. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>This code is pure Ruby, but even if you&rsquo;ve studied Ruby before it probably won&rsquo;t look very familiar. This is because RSpec uses the general malleability of Ruby to define a <em>domain-specific language</em> (DSL) built just for testing. The important point is that <em>you do not need to understand RSpec&rsquo;s syntax to be able to use RSpec</em>. It may seem like magic at first, but RSpec is designed to read more or less like English, and if you follow the examples from the <code>generate</code> script and the other examples in this tutorial you&rsquo;ll pick it up fairly quickly.</p>

<p><a class="ref" href="static-pages#code:default_pages_controller_spec">Listing&nbsp;3.11</a> contains two <code>describe</code> blocks, each with one <em>example</em> (i.e., a block starting with <code>it "&hellip;" do</code>). Let&rsquo;s focus on the first one to get a sense of what it does:</p>

<div class="code"><div class="highlight"><pre>  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
</pre></div>
</div>


<p>The first line indicates that we are describing a <tt>GET</tt> operation for the <code>home</code> action. This is just a description, and it can be anything you want; RSpec doesn&rsquo;t care, but you and other human readers probably do. In this case, <code>"GET &rsquo;home&rsquo;"</code> indicates that the test corresponds to an HTTP <tt>GET</tt> request, as discussed in <a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>. Then the spec says that when you visit the home page, it should be successful. As with the first line, what goes inside the quote marks is irrelevant to RSpec, and is intended to be descriptive to human readers. The third line, <code>get &rsquo;home&rsquo;</code>, is the first line that really does something. Inside of RSpec, this line <em>actually submits a GET request</em>; in other words, it acts like a browser and hits a page, in this case <tt>/pages/home</tt>. (It knows to hit the Pages controller automatically because this is a Pages controller test; it knows to hit the home page because we tell it to explicitly.) Finally, the fourth line says that the <em>response</em> of our application should indicate success (i.e., it should return a <em>status code</em> of <tt>200</tt>; see <a class="ref" href="static-pages#sidebar:response_codes">Box&nbsp;3.2</a>).</p>

<div class="label" id="sidebar:response_codes"></div>


<div class="sidebar"><span class="title"><span class="header">Box 3.2.</span><span class="description">HTTP response codes</span></span>
<p>After a client (such as a web browser) sends a request corresponding to one of the HTTP verbs (<a class="ref" href="static-pages#sidebar:get_etc">Box&nbsp;3.1</a>), the web server <em>responds</em> with a numerical code indicating the <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP status</a> of the response. For example, a status code of <tt>200</tt> means &ldquo;success&rdquo;, and a status code of 301 means &ldquo;permanent redirect&rdquo;. If you <a href="http://www.google.com/search?q=install+curl">install <tt>curl</tt></a>, a command-line client that can issue HTTP requests, you can see this directly at, e.g., <tt>www.google.com</tt> (where the <tt class="verb">--head</tt> flag prevents <code>curl</code> from returning the whole page):</p>

<pre class="verbatim">  $ curl --head www.google.com
  HTTP/1.1 200 OK
  .
  .
  .</pre>


<p>Here Google indicates that the request was successful by returning the status <tt>200&nbsp;OK</tt>. In contrast, <tt>google.com</tt> is permanently redirected (to <tt>www.google.com</tt>, naturally), indicated by status code  <tt>301</tt> (a &ldquo;<tt>301</tt> redirect&rdquo;):</p>

<pre class="verbatim">  $ curl --head google.com
  HTTP/1.1 301 Moved Permanently
  Location: http://www.google.com/
  .
  .
  .</pre>


<p>(<em>Note:</em> The above results may vary by country.)</p>

<p>When we write <code>response.should be_success</code> in an RSpec test, RSpec verifies that our application&rsquo;s response to the request is status code&nbsp;<tt>200</tt>.</p>
</div>


<p>Now it&rsquo;s time to run our tests. There are several different and mostly equivalent ways to do this.<sup class="footnote" id="fnref:3.13"><a href="#fn:3.13">13</a></sup> One way to run all the tests is to use the <code>rspec</code> script at the command line as follows:<sup class="footnote" id="fnref:3.14"><a href="#fn:3.14">14</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
<span class="go">....</span>

<span class="go">Finished in 0.07252 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>(Unfortunately, lots of things can go wrong at this point. If the test suite fails, try migrating the database with <code>bundle exec rake db:migrate</code> as described in <a class="ref" href="a-demo-app#sec:demo_users_resource">Section&nbsp;2.2</a>. If RSpec doesn&rsquo;t work at all, try uninstalling and reinstalling it:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> gem uninstall rspec rspec-rails
<span class="gp">$</span> bundle install
</pre></div>
</div>


<p>If it still doesn&rsquo;t work and you&rsquo;re using <a href="http://rvm.beginrescueend.com/">RVM</a>, try removing the Rails Tutorial gemset and reinstalling the gems:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rvm gemset delete rails3tutorial
<span class="gp">$</span> rvm --create use 1.9.2@rails3tutorial
<span class="gp">$</span> rvm --default 1.9.2@rails3tutorial
<span class="gp">$</span> gem install rails -v 3.0.9
<span class="gp">$</span> bundle install
</pre></div>
</div>


<p>If it still doesn&rsquo;t work, I&rsquo;m out of ideas.)</p>

<p>When running <code>bundle exec rspec spec/</code>, <code>rspec</code> is a program provided by RSpec, while <code>spec/</code> is the <em>directory</em> whose specs you want to run. You can also run only the specs in a particular subdirectory. For example, this command runs only the controller specs:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/controllers/
<span class="go">....</span>
<span class="go">Finished in 0.07502 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>You can also run a single file:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/controllers/pages_controller_spec.rb
<span class="go">....</span>
<span class="go">Finished in 0.07253 seconds</span>

<span class="go">2 examples, 0 failures</span>
</pre></div>
</div>


<p>Note that, as in <a class="ref" href="a-demo-app#sec:demo_users_resource">Section&nbsp;2.2</a>, we have used <code>bundle exec</code> to use the executable (in this case, <code>rspec</code>) corresponding to the gems in our application&rsquo;s <code>Gemfile</code>. Since this construction is a bit verbose, Bundler allows the creation of the associated binaries as follows:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install --binstubs
</pre></div>
</div>


<p>This creates all the necessary executables in the <code>bin/</code> directory of the application, so that we can now run the test suite as follows:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bin/rspec spec/
</pre></div>
</div>


<p>The same goes for <code>rake</code>, etc.:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bin/rake db:migrate
</pre></div>
</div>


<p>For the sake of readers who skip this section, the rest of this tutorial will err on the side of caution and explicitly use <code>bundle exec</code>, but of course you should feel free to use the more compact version.</p>

<p>The results of all three commands above are the same since the Pages controller spec is currently our only test file. Throughout the rest of this book, I won&rsquo;t usually show the output of running the tests, but you should run <code>bundle exec rspec spec/</code> (or one of its variants) regularly as you follow along&mdash;or, better yet, use Autotest to run the test suite automatically. Speaking of which&hellip;</p>

<p>If you&rsquo;ve installed Autotest, you can run it on your RSpec tests using the <code>autotest</code> command:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> autotest
</pre></div>
</div>


<p>If you&rsquo;re using a Mac with Growl notifications enabled, you might be able to replicate my setup, shown in <a class="ref" href="static-pages#fig:autotest_green">Figure&nbsp;3.6</a>. With Autotest running in the background and Growl notifications telling you the status of your tests, TDD can be positively addictive.</p>

<div class="label" id="fig:autotest_green"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_green.png" alt="autotest_green" /></span></div><div class="caption"><span class="header">Figure 3.6: </span><span class="description">Autotest (via <code>autotest</code>) in action, with a Growl notification.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_green-full.png">(full size)</a></span></div></div>




<div class="label" id="sec:spork"></div>


<h4><a id="sec:3.2.2.1" href="static-pages#sec:spork" class="heading">Spork</a></h4>


<p>You may have noticed that the overhead involved in running a test suite can be considerable. This is because each time RSpec runs the tests it has to reload the entire Rails environment. The <a href="http://github.com/timcharper/spork">Spork test server</a><sup class="footnote" id="fnref:3.15"><a href="#fn:3.15">15</a></sup> aims to solve this problem. Spork loads the environment <em>once</em>, and then maintains a pool of processes for running future tests. Spork is particularly useful when combined with Autotest.</p>

<p>Configuring Spork and getting it to work can be difficult, and this is a rather advanced topic. <strong>If you get stuck, don&rsquo;t hesitate to skip this section for now.</strong></p>

<p>The first step is to add the <tt>spork</tt> gem dependency to the <code>Gemfile</code> (<a class="ref" href="static-pages#code:gemfile_spork">Listing&nbsp;3.12</a>).</p>

<div class="label" id="code:gemfile_spork"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.12.</span> <span class="description">A <code>Gemfile</code> for the sample app.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.9&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.3&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.6.1&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.6.1&#39;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="n">gem</span> <span class="s1">&#39;spork&#39;</span><span class="p">,</span> <span class="s1">&#39;0.9.0.rc8&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Then install it:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Next, bootstrap the Spork configuration:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>spork --bootstrap
</pre></div>
</div>


<p>Now we need to edit the RSpec configuration file, <code>spec/spec_helper.rb</code>, so that the environment gets loaded in a <em>prefork</em> block, which arranges for it to be loaded only once (<a class="ref" href="static-pages#code:spork_spec_helper">Listing&nbsp;3.13</a>). <em>Note:</em> Only use this code if you are also using Spork. If you try to use <a class="ref" href="static-pages#code:spork_spec_helper">Listing&nbsp;3.13</a> without Spork, your application test suite will not run.</p>

<div class="label" id="code:spork_spec_helper"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.13.</span> <span class="description">Adding environment loading to the <code>Spork.prefork</code> block. <br /> <code>spec/spec_helper.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spork&#39;</span>

<span class="no">Spork</span><span class="o">.</span><span class="n">prefork</span> <span class="k">do</span>
  <span class="c1"># Loading more in this block will cause your tests to run faster. However, </span>
  <span class="c1"># if you change any configuration or code from libraries loaded here, you&#39;ll</span>
  <span class="c1"># need to restart spork for it take effect.</span>
  <span class="no">ENV</span><span class="o">[</span><span class="s2">&quot;RAILS_ENV&quot;</span><span class="o">]</span> <span class="o">||=</span> <span class="s1">&#39;test&#39;</span>
  <span class="nb">require</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s2">&quot;../../config/environment&quot;</span><span class="p">,</span> <span class="bp">__FILE__</span><span class="p">)</span>
  <span class="nb">require</span> <span class="s1">&#39;rspec/rails&#39;</span>

  <span class="c1"># Requires supporting files with custom matchers and macros, etc,</span>
  <span class="c1"># in ./support/ and its subdirectories.</span>
  <span class="no">Dir</span><span class="o">[</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;spec/support/**/*.rb&quot;</span><span class="p">)</span><span class="o">].</span><span class="n">each</span> <span class="p">{</span><span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="nb">require</span> <span class="n">f</span><span class="p">}</span>

  <span class="no">RSpec</span><span class="o">.</span><span class="n">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
    <span class="c1"># == Mock Framework</span>
    <span class="c1">#</span>
    <span class="c1"># If you prefer to use mocha, flexmock or RR, uncomment the appropriate line:</span>
    <span class="c1">#</span>
    <span class="c1"># config.mock_with :mocha</span>
    <span class="c1"># config.mock_with :flexmock</span>
    <span class="c1"># config.mock_with :rr</span>
    <span class="n">config</span><span class="o">.</span><span class="n">mock_with</span> <span class="ss">:rspec</span>

    <span class="n">config</span><span class="o">.</span><span class="n">fixture_path</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="o">::</span><span class="no">Rails</span><span class="o">.</span><span class="n">root</span><span class="si">}</span><span class="s2">/spec/fixtures&quot;</span>

    <span class="c1"># If you&#39;re not using ActiveRecord, or you&#39;d prefer not to run each of your</span>
    <span class="c1"># examples within a transaction, comment the following line or assign false</span>
    <span class="c1"># instead of true.</span>
    <span class="n">config</span><span class="o">.</span><span class="n">use_transactional_fixtures</span> <span class="o">=</span> <span class="kp">true</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="no">Spork</span><span class="o">.</span><span class="n">each_run</span> <span class="k">do</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Before running Spork, we can get a baseline for the testing overhead by timing our test suite as follows:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec spec/
<span class="go">..</span>


<span class="go">Finished in 0.09606 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m7.445s</span>
<span class="go">user    0m5.248s</span>
<span class="go">sys     0m1.475s</span>
</pre></div>
</div>


<p>Here the test suite takes more than seven seconds to run even though the actual tests run in under a tenth of a second. To speed this up, we can open a dedicated terminal window, navigate to the Rails root directory, and then start a Spork server:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>spork
<span class="go">Using RSpec</span>
<span class="go">Loading Spork.prefork block...</span>
<span class="go">Spork is ready and listening on 8989!</span>
</pre></div>
</div>


<p>In another terminal window, we can now run our test suite with the <tt class="verb">--drb</tt> option<sup class="footnote" id="fnref:3.16"><a href="#fn:3.16">16</a></sup> and verify that the environment-loading overhead is greatly reduced:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec --drb spec/
<span class="go">..</span>


<span class="go">Finished in 0.10519 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m0.803s</span>
<span class="go">user    0m0.354s</span>
<span class="go">sys     0m0.171s</span>
</pre></div>
</div>


<p>As expected, the overhead has been dramatically reduced.</p>

<p>To run RSpec and Spork with Autotest, we need to configure RSpec to use the <tt class="verb">--drb</tt> option by default, which we can arrange by adding it to the <code>.rspec</code> configuration file in the Rails root directory (<a class="ref" href="static-pages#code:dot_rspec">Listing&nbsp;3.14</a>).</p>

<div class="label" id="code:dot_rspec"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.14.</span> <span class="description">Adding the <tt class="verb">--drb</tt> option to the <code>.rspec</code> file.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="o">--</span><span class="n">colour</span>
<span class="o">--</span><span class="n">drb</span>
</pre></div>
</div></div>


<p>With this updated <code>.rspec</code> file, the test suite should run as quickly as before, even without the explicit <tt class="verb">--drb</tt> option:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">time </span>rspec spec/
<span class="go">..</span>


<span class="go">Finished in 0.10926 seconds</span>
<span class="go">2 examples, 0 failures</span>

<span class="go">real    0m0.803s</span>
<span class="go">user    0m0.355s</span>
<span class="go">sys     0m0.171s</span>
</pre></div>
</div>


<p>Of course, running <code>time</code> here is just for purposes of illustration; normally, you just run</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>or</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> autotest
</pre></div>
</div>


<p>without the <code>time</code> command.</p>

<p>One word of advice when using Spork: if your tests are failing when you think they should be passing, the problem might be the Spork prefork loading, which can sometimes prevent necessary files from being re-loaded. When in doubt, quit the Spork server with <tt>Control-C</tt> and restart it:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>spork
<span class="go">Using RSpec</span>
<span class="go">Loading Spork.prefork block...</span>
<span class="go">Spork is ready and listening on 8989!</span>
<span class="go">^C</span>
<span class="gp">$</span> bundle <span class="nb">exec </span>spork
</pre></div>
</div>




<div class="label" id="sec:red"></div>


<h4><a id="sec:3.2.2.2" href="static-pages#sec:red" class="heading">Red</a></h4>


<p>Now let&rsquo;s get to the Red part of the Red-Green cycle by writing a failing test for the <code>about</code> page. Following the models from <a class="ref" href="static-pages#code:default_pages_controller_spec">Listing&nbsp;3.11</a>, you can probably guess the right test (<a class="ref" href="static-pages#code:failing_about_page">Listing&nbsp;3.15</a>).</p>

<div class="label" id="code:failing_about_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.15.</span> <span class="description">The Pages controller spec with a failing test for the About page. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Note that we&rsquo;ve added a line to tell RSpec to <em>render the views</em> inside the controller tests. In other words, by default RSpec just tests actions inside a controller test; if we want it also to render the views, we have to tell it explicitly via the second line:</p>

<div class="code"><div class="highlight"><pre><span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
</pre></div>
</div>


<p>This ensures that if the test passes, the page is really there.</p>

<p>The new test attempts to <code>get</code> the <code>about</code> action, and indicates that the resulting response should be a success. By design, it fails (with a red error message), as seen in <a class="ref" href="static-pages#fig:rspec_spec_red">Figure&nbsp;3.7</a> (<code>rspec spec/</code>) and <a class="ref" href="static-pages#fig:autotest_red">Figure&nbsp;3.8</a> (<code>autotest</code>). (If you test the views in the controllers as recommended in this tutorial, it&rsquo;s worth noting that changing the view file won&rsquo;t prompt Autotest to run the corresponding controller test. There&rsquo;s probably a way to configure Autotest to do this automatically, but usually I just switch to the controller and press &ldquo;space-backspace&rdquo; so that the file gets marked as modified. Saving the controller then causes Autotest to run the tests as desired.)</p>

<div class="label" id="fig:rspec_spec_red"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/rspec_spec_red.png" alt="rspec_spec_red" /></span></div><div class="caption"><span class="header">Figure 3.7: </span><span class="description">Failing spec for the About page using <code>rspec spec/</code>.&nbsp;<a href="http://railstutorial.org/images/figures/rspec_spec_red-full.png">(full size)</a></span></div></div>




<div class="label" id="fig:autotest_red"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_red.png" alt="autotest_red" /></span></div><div class="caption"><span class="header">Figure 3.8: </span><span class="description">Failing spec for the About page using Autotest.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_red-full.png">(full size)</a></span></div></div>


<p>This is Red. Now let&rsquo;s get to Green.</p>

<div class="label" id="sec:green"></div>


<h4><a id="sec:3.2.2.3" href="static-pages#sec:green" class="heading">Green</a></h4>


<p>Recall from <a class="ref" href="static-pages#sec:static_pages_with_rails">Section&nbsp;3.1.2</a> that we can generate a static page in Rails by creating an action and corresponding view with the page&rsquo;s name. In our case, the About page will first need an action called <code>about</code> in the Pages controller. Having written a failing test, we can now be confident that, in getting it to pass, we will actually have created a working <code>about</code> page.</p>

<p>Following the models provided by <code>home</code> and <code>contact</code> from <a class="ref" href="static-pages#code:pages_controller">Listing&nbsp;3.6</a>, let&rsquo;s first add an <code>about</code> action in the Pages controller (<a class="ref" href="static-pages#code:adding_the_about_page">Listing&nbsp;3.16</a>).</p>

<div class="label" id="code:adding_the_about_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.16.</span> <span class="description">The Pages controller with added <code>about</code> action. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Next, we&rsquo;ll add the <code>about</code> action to the routes file (<a class="ref" href="static-pages#code:about_route">Listing&nbsp;3.17</a>).</p>

<div class="label" id="code:about_route"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.17.</span> <span class="description">Adding the <code>about</code> route. <br /> <code>config/routes.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="no">SampleApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s2">&quot;pages/home&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/contact&quot;</span>
  <span class="n">get</span> <span class="s2">&quot;pages/about&quot;</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Finally, we&rsquo;ll add the <code>about</code> view. Eventually we&rsquo;ll fill it with something more informative, but for now we&rsquo;ll just mimic the content from the generated views (<a class="ref" href="static-pages#code:raw_home_view">Listing&nbsp;3.7</a> and <a class="ref" href="static-pages#code:raw_contact_view">Listing&nbsp;3.8</a>) for the <code>about</code> view (<a class="ref" href="static-pages#code:raw_about_view">Listing&nbsp;3.18</a>).</p>

<div class="label" id="code:raw_about_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.18.</span> <span class="description">A stub About page. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Pages#about<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>Find me in app/views/pages/about.html.erb<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>Running the specs or watching the update from Autotest (<a class="ref" href="static-pages#fig:autotest_back_to_green">Figure&nbsp;3.9</a>) should get us back to Green:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<div class="label" id="fig:autotest_back_to_green"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/autotest_back_to_green.png" alt="autotest_back_to_green" /></span></div><div class="caption"><span class="header">Figure 3.9: </span><span class="description">Autotest back to Green: All tests passing.&nbsp;<a href="http://railstutorial.org/images/figures/autotest_back_to_green-full.png">(full size)</a></span></div></div>


<p>Of course, it&rsquo;s never a bad idea to take a look at the page in a browser to make sure our tests aren&rsquo;t completely crazy (<a class="ref" href="static-pages#fig:raw_about_page">Figure&nbsp;3.10</a>).</p>

<div class="label" id="fig:raw_about_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/raw_about_page.png" alt="raw_about_page" /></span></div><div class="caption"><span class="header">Figure 3.10: </span><span class="description">The new (and rather raw) About page (<a href="http://localhost:3000/pages/about"><tt>/pages/about</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/raw_about_page-full.png">(full size)</a></span></div></div>




<div class="label" id="sec:refactor"></div>


<h4><a id="sec:3.2.2.4" href="static-pages#sec:refactor" class="heading">Refactor</a></h4>


<p>Now that we&rsquo;re at Green, we are free to <em>refactor</em> our code by changing its form without changing its function. Oftentimes code will start to &ldquo;smell&rdquo;, meaning that it gets ugly, bloated, or filled with repetition.  The computer doesn&rsquo;t care, of course, but humans do, so it is important to keep the code base clean by refactoring frequently. Having a good (passing!) test suite is an invaluable tool in this regard, as it dramatically lowers the probability of introducing bugs while refactoring.</p>

<p>Our sample app is a little too small to refactor right now, but code smell seeps in at every crack, so we won&rsquo;t have to wait long: we&rsquo;ll already get busy refactoring in <a class="ref" href="static-pages#sec:instance_variables_embedded_ruby">Section&nbsp;3.3.3</a> of this chapter.</p>

<div class="label" id="sec:slightly_dynamic_pages"></div>


<h2><a id="sec:3.3" href="static-pages#sec:slightly_dynamic_pages" class="heading"><span class="number">3.3</span> Slightly dynamic pages</a></h2>


<p>Now that we&rsquo;ve created the actions and views for some static pages, we&rsquo;ll make them <em>very slightly</em> dynamic by adding some content that changes on a per-page basis: we&rsquo;ll have the title of each page change to reflect its content. Whether this represents <em>truly</em> dynamic content is debatable, but in any case it lays the necessary foundation for unambiguously dynamic content in <a class="ref" href="sign-up#top">Chapter&nbsp;8</a>.</p>

<p>(If you skipped the TDD material in <a class="ref" href="static-pages#sec:first_tests">Section&nbsp;3.2</a>, be sure to create an About page at this point using the code from <a class="ref" href="static-pages#code:adding_the_about_page">Listing&nbsp;3.16</a>, <a class="ref" href="static-pages#code:about_route">Listing&nbsp;3.17</a>, and <a class="ref" href="static-pages#code:raw_about_view">Listing&nbsp;3.18</a>.)</p>

<div class="label" id="sec:testing_a_title_change"></div>


<h3><a id="sec:3.3.1" href="static-pages#sec:testing_a_title_change" class="heading"><span class="number">3.3.1</span> Testing a title change</a></h3>


<p>Our plan is to edit the Home, Contact, and About pages to add the kind of HTML structure we saw in <a class="ref" href="static-pages#code:hello_world">Listing&nbsp;3.3</a>, including titles that change on each page. It&rsquo;s a delicate matter to decide just which of these changes to test, and in general testing HTML can be quite fragile since content tends to change frequently. We&rsquo;ll keep our tests simple by just testing for the page titles.</p>

<div class="label" id="table:static_pages"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_center"><strong>Page</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Base title</strong></th><th class="align_left"><strong>Variable title</strong></th></tr><tr class="top_bar"><td class="align_center">Home</td><td class="align_left"><tt>/pages/home</tt></td><td class="align_left"><code>"Ruby on Rails Tutorial Sample App"</code></td><td class="align_left"><code>" | Home"</code></td></tr><tr><td class="align_center">Contact</td><td class="align_left"><tt>/pages/contact</tt></td><td class="align_left"><code>"Ruby on Rails Tutorial Sample App"</code></td><td class="align_left"><code>" | Contact"</code></td></tr><tr><td class="align_center">About</td><td class="align_left"><tt>/pages/about</tt></td><td class="align_left"><code>"Ruby on Rails Tutorial Sample App"</code></td><td class="align_left"><code>" | About"</code></td></tr></table></div><div class="caption"><span class="header">Table 3.1: </span><span class="description">The (mostly) static pages for the sample app.</span></div></div>


<p>By the end of this section, all three of our static pages will have titles of the form &ldquo;Ruby on Rails Tutorial Sample App | Home&rdquo;, where the last part of the title will vary depending on the page (<a class="ref" href="static-pages#table:static_pages">Table&nbsp;3.1</a>). We&rsquo;ll build on the tests in <a class="ref" href="static-pages#code:failing_about_page">Listing&nbsp;3.15</a>, adding title tests following the model in <a class="ref" href="static-pages#code:title_test">Listing&nbsp;3.19</a>.</p>

<div class="label" id="code:title_test"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.19.</span> <span class="description">A title test.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
  <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
  <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>This uses the <code>have_selector</code> method inside RSpec; the documentation for <code>have_selector</code> is surprisingly sparse, but what it does is to check for an HTML element (the &ldquo;selector&rdquo;) with the given content. In other words, the code</p>

<div class="code"><div class="highlight"><pre><span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                  <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>checks to see that the content inside the <tt class="verb">&lt;title&gt;&lt;/title&gt;</tt> tags is <code>"Ruby on Rails Tutorial Sample App | Home"</code>.<sup class="footnote" id="fnref:3.17"><a href="#fn:3.17">17</a></sup> It&rsquo;s worth mentioning that the content need not be an exact match; any substring works as well, so that</p>

<div class="code"><div class="highlight"><pre><span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span> <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot; | Home&quot;</span><span class="p">)</span>
</pre></div>
</div>


<p>will also match the full title.<sup class="footnote" id="fnref:3.18"><a href="#fn:3.18">18</a></sup></p>

<p>Note that in <a class="ref" href="static-pages#code:title_test">Listing&nbsp;3.19</a> I&rsquo;ve broken the material inside <code>have_selector</code> into two lines; this tells you something important about Ruby syntax: Ruby doesn&rsquo;t care about newlines.<sup class="footnote" id="fnref:3.19"><a href="#fn:3.19">19</a></sup> The <em>reason</em> I chose to break the code into pieces is that I prefer to keep lines of source code under 80 characters for legibility.<sup class="footnote" id="fnref:3.20"><a href="#fn:3.20">20</a></sup> As it stands, I still find this code formatting rather ugly; <a class="ref" href="static-pages#sec:static_pages_exercises">Section&nbsp;3.5</a> has a refactoring exercise that makes them much prettier.<sup class="footnote" id="fnref:3.21"><a href="#fn:3.21">21</a></sup></p>

<p>Adding new tests for each of our three static pages following the model of <a class="ref" href="static-pages#code:title_test">Listing&nbsp;3.19</a> gives us our new Pages controller spec (<a class="ref" href="static-pages#code:pages_controller_spec_title">Listing&nbsp;3.20</a>).</p>

<div class="label" id="code:pages_controller_spec_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.20.</span> <span class="description">The Pages controller spec with title tests. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Home&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span>
                          <span class="s2">&quot;Ruby on Rails Tutorial Sample App | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                        <span class="ss">:content</span> <span class="o">=&gt;</span>
                          <span class="s2">&quot;Ruby on Rails Tutorial Sample App | About&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Note that the <code>render_views</code> line introduced in <a class="ref" href="static-pages#code:failing_about_page">Listing&nbsp;3.15</a> is necessary for the title tests to work.</p>

<p>With these tests in place, you should run</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
</pre></div>
</div>


<p>or use Autotest to verify that our code is now Red (failing tests).</p>

<div class="label" id="sec:passing_title_tests"></div>


<h3><a id="sec:3.3.2" href="static-pages#sec:passing_title_tests" class="heading"><span class="number">3.3.2</span> Passing title tests</a></h3>


<p>Now we&rsquo;ll get our title tests to pass, and at the same time add the full HTML structure needed to make valid web pages. Let&rsquo;s start with the Home page (<a class="ref" href="static-pages#code:home_view_full_html">Listing&nbsp;3.21</a>), using the same basic HTML skeleton as in the &ldquo;hello&rdquo; page from <a class="ref" href="static-pages#code:hello_world">Listing&nbsp;3.3</a>.</p>

<p><em>Note:</em> In Rails&nbsp;3, the controller generator creates a <em>layout</em> file, whose purpose we will explain shortly, but which for now you should remove before proceeding:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rm app/views/layouts/application.html.erb
</pre></div>
</div>


<div class="label" id="code:home_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.21.</span> <span class="description">The view for the Home page with full HTML structure. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Home<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      This is the home page for the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      sample application.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="static-pages#code:home_view_full_html">Listing&nbsp;3.21</a> uses the title tested for in <a class="ref" href="static-pages#code:pages_controller_spec_title">Listing&nbsp;3.20</a>:</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Home<span class="nt">&lt;/title&gt;</span>
</pre></div>
</div>


<p>As a result, the tests for the Home page should now pass. We&rsquo;re still Red because of the failing Contact and About tests, and we can get to Green with the code in <a class="ref" href="static-pages#code:contact_view_full_html">Listing&nbsp;3.22</a> and <a class="ref" href="static-pages#code:about_view_full_html">Listing&nbsp;3.23</a>.</p>

<div class="label" id="code:contact_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.22.</span> <span class="description">The view for the Contact page with full HTML structure. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | Contact<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Contact Ruby on Rails Tutorial about the sample app at the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>feedback page<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_full_html"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.23.</span> <span class="description">The view for the About page with full HTML structure. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | About<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      is a project to make a book and screencasts to teach web development
      with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
      is the sample application for the tutorial.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>These example pages introduce the <em>anchor</em> tag&nbsp;<code>a</code>, which creates links to the given URL (called an &ldquo;href&rdquo;, or &ldquo;hypertext reference&rdquo;, in the context of an anchor tag):</p>

<div class="code"><div class="highlight"><pre><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
</pre></div>
</div>


<p>You can see the results in <a class="ref" href="static-pages#fig:new_home_page">Figure&nbsp;3.11</a>.</p>

<div class="label" id="fig:new_home_page"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/new_home_page.png" alt="new_home_page" /></span></div><div class="caption"><span class="header">Figure 3.11: </span><span class="description">A minimal Home page for the sample app (<a href="http://localhost:3000/pages/home"><tt>/pages/home</tt></a>).&nbsp;<a href="http://railstutorial.org/images/figures/new_home_page-full.png">(full size)</a></span></div></div>




<div class="label" id="sec:instance_variables_embedded_ruby"></div>


<h3><a id="sec:3.3.3" href="static-pages#sec:instance_variables_embedded_ruby" class="heading"><span class="number">3.3.3</span> Instance variables and Embedded Ruby</a></h3>


<p>We&rsquo;ve achieved a lot already in this section, generating three valid pages using Rails controllers and actions, but they are purely static HTML and hence don&rsquo;t show off the power of Rails. Moreover, they suffer from terrible duplication:</p>

<ul>
<li>The page titles are almost (but not quite) exactly the same.</li>
<li>&ldquo;Ruby on Rails Tutorial Sample App&rdquo; is common to all three titles.</li>
<li>The entire HTML skeleton structure is repeated on each page.</li>
</ul>


<p>This repeated code is a violation of the important &ldquo;Don&rsquo;t Repeat Yourself&rdquo; (DRY) principle; in this section and the next we&rsquo;ll &ldquo;DRY out our code&rdquo; by removing the repetition.</p>

<p>Paradoxically, we&rsquo;ll take the first step toward eliminating duplication by first adding some more: we&rsquo;ll make the titles of the pages, which are currently quite similar, match <em>exactly</em>. This will make it much simpler to remove all the repetition at a stroke.</p>

<p>The technique involves creating <em>instance variables</em> inside our actions. Since the Home, Contact, and About page titles have a variable component, we&rsquo;ll set the variable <code>@title</code> (pronounced &ldquo;at title&rdquo;) to the appropriate title for each action (<a class="ref" href="static-pages#code:pages_controller_with_title">Listing&nbsp;3.24</a>).</p>

<div class="label" id="code:pages_controller_with_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.24.</span> <span class="description">The Pages controller with per-page titles. <br /> <code>app/controllers/pages_controller.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">PagesController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">home</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;Home&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">contact</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;Contact&quot;</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">about</span>
    <span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;About&quot;</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>A statement such as</p>

<div class="code"><div class="highlight"><pre><span class="vi">@title</span> <span class="o">=</span> <span class="s2">&quot;Home&quot;</span>
</pre></div>
</div>


<p>is an <em>assignment</em>, in this case creating a new variable <code>@title</code> with value <code>"Home"</code>. The at sign&nbsp;<code>@</code> in <code>@title</code> indicates that it is an instance variable. Instance variables have a more general meaning in Ruby (see <a class="ref" href="rails-flavored-ruby#sec:objects_and_message_passing">Section&nbsp;4.2.3</a>), but in Rails their role is primarily to link actions and views: any instance variable defined in the <code>home</code> action is automatically available in the <code>home.html.erb</code> view, and so on for other action/view pairs.<sup class="footnote" id="fnref:3.22"><a href="#fn:3.22">22</a></sup></p>

<p>We can see how this works by replacing the literal title &ldquo;Home&rdquo; with the contents of the <code>@title</code> variable in the <code>home.html.erb</code> view (<a class="ref" href="static-pages#code:home_view_erb_title">Listing&nbsp;3.25</a>).</p>

<div class="label" id="code:home_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.25.</span> <span class="description">The view for the Home page with an Embedded Ruby title. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      This is the home page for the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      sample application.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p><a class="ref" href="static-pages#code:home_view_erb_title">Listing&nbsp;3.25</a> is our first example of <em>Embedded Ruby</em>, also called <em>ERb</em>. (Now you know why HTML views have the file extension <code>.html.erb</code>.) ERb is the primary mechanism in Rails for including dynamic content in web pages.<sup class="footnote" id="fnref:3.23"><a href="#fn:3.23">23</a></sup> The code</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>indicates using <tt class="verb">&lt;%= ... %&gt;</tt> that Rails should insert the contents of the <code>@title</code> variable, whatever it may be. When we visit <tt>/pages/home</tt>, Rails executes the body of the <code>home</code> action, which makes the assignment <code>@title = "Home"</code>, so in the present case</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>gets replaced with &ldquo;Home&rdquo;. Rails then renders the view, using ERb to insert the value of <code>@title</code> into the template, which the web server then sends to your browser as HTML. The result is exactly the same as before, only now the variable part of the title is generated dynamically by ERb.</p>

<p>We can verify that all this works by running the tests from <a class="ref" href="static-pages#sec:testing_a_title_change">Section&nbsp;3.3.1</a> and see that they still pass. Then we can make the corresponding replacements for the Contact and About pages (<a class="ref" href="static-pages#code:contact_view_erb_title">Listing&nbsp;3.26</a> and <a class="ref" href="static-pages#code:about_view_erb_title">Listing&nbsp;3.27</a>).</p>

<div class="label" id="code:contact_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.26.</span> <span class="description">The view for the Contact page with an Embedded Ruby title. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      Contact Ruby on Rails Tutorial about the sample app at the
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>feedback page<span class="nt">&lt;/a&gt;</span>.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_erb_title"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.27.</span> <span class="description">The view for the About page with an Embedded Ruby title. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;p&gt;</span>
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
      is a project to make a book and screencasts to teach web development
      with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
      is the sample application for the tutorial.
    <span class="nt">&lt;/p&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>As before, the tests still pass.</p>

<div class="label" id="sec:layouts"></div>


<h3><a id="sec:3.3.4" href="static-pages#sec:layouts" class="heading"><span class="number">3.3.4</span> Eliminating duplication with layouts</a></h3>


<p>Now that we&rsquo;ve replaced the variable part of the page titles with instance variables and ERb, each of our pages looks something like this:</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
      Contents
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>


<p>In other words, <em>all</em> our pages are identical in structure, including even the title (because of Embedded Ruby), with the sole exception of the contents of each page.</p>

<p>Wouldn&rsquo;t it be nice if there were a way to factor out the common elements into some sort of global layout, with the body contents inserted on a per-page basis? Indeed, it would be nice, and Rails happily obliges using a special file called <code>application.html.erb</code>, which lives in the <code>layouts</code> directory. To capture the structural skeleton, create the file <code>application.html.erb</code> and fill it with the contents of <a class="ref" href="static-pages#code:application_layout">Listing&nbsp;3.28</a>.</p>

<div class="label" id="code:application_layout"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.28.</span> <span class="description">The sample application site layout. <br /> <code>app/views/layouts/application.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>Ruby on Rails Tutorial Sample App | <span class="cp">&lt;%=</span> <span class="vi">@title</span> <span class="cp">%&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div></div>


<p>Note here the special line</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>This code is responsible for inserting the contents of each page into the layout. As with <tt class="verb">&lt;%= @title %&gt;</tt>, the <tt class="verb">&lt;% ... %&gt;</tt> tags indicate Embedded Ruby, and the equals sign in <tt class="verb">&lt;%= ... %&gt;</tt> ensures that the results of evaluating the expression are inserted at that exact point in the template. (Don&rsquo;t worry about the meaning of the word &ldquo;yield&rdquo; in this context;<sup class="footnote" id="fnref:3.24"><a href="#fn:3.24">24</a></sup> what matters is that using this layout ensures that visiting the page <tt>/pages/home</tt> converts the contents of <code>home.html.erb</code> to HTML and then inserts it in place of <tt class="verb">&lt;%= yield %&gt;</tt>.</p>

<p>Now that we have a site-wide layout, we&rsquo;ve also taken this opportunity to add a security feature to each page. <a class="ref" href="static-pages#code:application_layout">Listing&nbsp;3.28</a> adds the code</p>

<div class="code"><div class="highlight"><pre><span class="cp">&lt;%=</span> <span class="n">csrf_meta_tag</span> <span class="cp">%&gt;</span>
</pre></div>
</div>


<p>which uses the Rails method <code>csrf_meta_tag</code> to prevent <a href="http://en.wikipedia.org/wiki/Cross-site_request_forgery">cross-site request forgery</a> (CSRF), a type of malicious web attack. Don&rsquo;t worry about the details (I don&rsquo;t); just know that Rails is working hard to keep your application secure.</p>

<p>Of course, the views in <a class="ref" href="static-pages#code:home_view_erb_title">Listing&nbsp;3.25</a>, <a class="ref" href="static-pages#code:contact_view_erb_title">Listing&nbsp;3.26</a>, and <a class="ref" href="static-pages#code:about_view_erb_title">Listing&nbsp;3.27</a> are still filled with all the HTML structure we just hoisted into the layout, so we have to rip it out, leaving only the interior contents. The resulting cleaned-up views appear in <a class="ref" href="static-pages#code:home_view_interior">Listing&nbsp;3.29</a>, <a class="ref" href="static-pages#code:contact_view_interior">Listing&nbsp;3.30</a>, and <a class="ref" href="static-pages#code:about_view_interior">Listing&nbsp;3.31</a>.</p>

<div class="label" id="code:home_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.29.</span> <span class="description">The Home view with HTML structure removed. <br /> <code>app/views/pages/home.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Sample App<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  This is the home page for the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  sample application.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:contact_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.30.</span> <span class="description">The Contact view with HTML structure removed. <br /> <code>app/views/pages/contact.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Contact<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Contact Ruby on Rails Tutorial about the sample app at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/feedback&quot;</span><span class="nt">&gt;</span>feedback page<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:about_view_interior"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.31.</span> <span class="description">The About view with HTML structure removed. <br /> <code>app/views/pages/about.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>About Us<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails Tutorial<span class="nt">&lt;/a&gt;</span>
  is a project to make a book and screencasts to teach web development
  with <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://rubyonrails.org/&quot;</span><span class="nt">&gt;</span>Ruby on Rails<span class="nt">&lt;/a&gt;</span>. This
  is the sample application for the tutorial.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>


<p>With these views defined, the Home, Contact, and About pages are exactly the same as before&mdash;i.e., we have successfully refactored them&mdash;but they have much less duplication. And, as required, the tests still pass.</p>

<div class="label" id="sec:static_pages_conclusion"></div>


<h2><a id="sec:3.4" href="static-pages#sec:static_pages_conclusion" class="heading"><span class="number">3.4</span> Conclusion</a></h2>


<p>Seen from the outside, this chapter hardly accomplished anything: we started with static pages, and ended with&hellip; <em>mostly</em> static pages. But appearances are deceiving: by developing in terms of Rails controllers, actions, and views, we are now in a position to add arbitrary amounts of dynamic content to our site. Seeing exactly how this plays out is the task for the rest of this tutorial.</p>

<p>Before moving on, let&rsquo;s take a minute to commit our changes and merge them into the master branch. Back in <a class="ref" href="static-pages#sec:static_pages_with_rails">Section&nbsp;3.1.2</a> we created a Git branch for the development of static pages. If you haven&rsquo;t been making commits as we&rsquo;ve been moving along, first make a commit indicating that we&rsquo;ve reached a stopping point:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Done with static pages&quot;</span>
</pre></div>
</div>


<p>Then merge the changes back into the master branch using the same technique as in <a class="ref" href="beginning#sec:git_commands">Section&nbsp;1.3.5</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git checkout master
<span class="gp">$</span> git merge static-pages
</pre></div>
</div>


<p>Once you reach a stopping point like this, it&rsquo;s usually a good idea to push your code up to a remote repository (which, if you followed the steps in <a class="ref" href="beginning#sec:github">Section&nbsp;1.3.4</a>, will be GitHub):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
<span class="gp">$</span> git push
</pre></div>
</div>


<p>If you like, at this point you can even deploy the updated application to Heroku:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rspec spec/
<span class="gp">$</span> git push heroku
</pre></div>
</div>


<p>Note that in both cases I&rsquo;ve run <code>rspec spec/</code>, just to be sure that all the tests still pass. Running your tests before pushing or deploying is a good habit to cultivate.</p>

<div class="label" id="sec:static_pages_exercises"></div>


<h2><a id="sec:3.5" href="static-pages#sec:static_pages_exercises" class="heading"><span class="number">3.5</span> Exercises</a></h2>




<ol>

<li>Make a Help page for the sample app. First write a test for the existence of a page at the URL <tt>/pages/help</tt>. Then write a second test for the title &ldquo;Ruby on Rails Tutorial Sample App | Help&rdquo;. Get your tests to pass, and then fill in the Help page with the content from <a class="ref" href="static-pages#code:help_page">Listing&nbsp;3.32</a>.</li>

<li>You may have noticed some repetition in the Pages controller spec (<a class="ref" href="static-pages#code:pages_controller_spec_title">Listing&nbsp;3.20</a>). In particular, the base title, &ldquo;Ruby on Rails Tutorial Sample App&rdquo;, is the same for every title test. Using the RSpec <code>before(:each)</code> facility, which executes a block of code before each test case, fill in <a class="ref" href="static-pages#code:pages_controller_spec_exercise">Listing&nbsp;3.33</a> to define a <code>@base_title</code> instance variable that eliminates this duplication. (This code uses two new elements: a <em>symbol</em>, <code>:each</code>, and the string concatenation operator <code>+</code>. We&rsquo;ll learn more about both in <a class="ref" href="rails-flavored-ruby#top">Chapter&nbsp;4</a>, and we&rsquo;ll see <code>before(:each)</code> again in <a class="ref" href="modeling-and-viewing-users-one#sec:presence_validation">Section&nbsp;6.2.1</a>.) Note that, with the base title captured in an instance variable, we are now able to align <code>:content</code> with the first character inside each left parenthesis&nbsp;<code>(</code>. This is my preferred convention for formatting code broken into multiple lines.</li>

<li>The Autotest gem installations in <a class="ref" href="static-pages#sec:autotest">Section&nbsp;3.2.1.1</a> should probably be in the <code>:test</code> area of <code>Gemfile</code>. Add Autotest to the <code>Gemfile</code> by uncommenting the appropriate lines in <a class="ref" href="static-pages#code:gemfile_autotest">Listing&nbsp;3.34</a>. Then run <code>bundle install</code> and verify that you can run Autotest using <code>bundle exec autotest</code>. <em>Extra credit</em>: Run <tt class="verb">bundle install --binstubs</tt> so that you can run Autotest using <code>bin/autotest</code>.</li>

</ol>




<div class="label" id="code:help_page"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.32.</span> <span class="description">Code for a proposed Help page. <br /> <code>app/views/pages/help.html.erb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Help<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;p&gt;</span>
  Get help on Ruby on Rails Tutorial at the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/help&quot;</span><span class="nt">&gt;</span>Rails Tutorial help page<span class="nt">&lt;/a&gt;</span>.
  To get help on this sample app, see the
  <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://railstutorial.org/book&quot;</span><span class="nt">&gt;</span>Rails Tutorial book<span class="nt">&lt;/a&gt;</span>.
<span class="nt">&lt;/p&gt;</span>
</pre></div>
</div></div>




<div class="label" id="code:pages_controller_spec_exercise"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.33.</span> <span class="description">The Pages controller spec with a base title. <br /> <code>spec/controllers/pages_controller_spec.rb</code></span>       
</div>
<div class="code"><div class="highlight"><pre><span class="nb">require</span> <span class="s1">&#39;spec_helper&#39;</span>

<span class="n">describe</span> <span class="no">PagesController</span> <span class="k">do</span>
  <span class="n">render_views</span>

  <span class="n">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
    <span class="c1">#</span>
    <span class="c1"># Define @base_title here.</span>
    <span class="c1">#</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;home&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;home&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | Home&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;contact&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;contact&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | Contact&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>

  <span class="n">describe</span> <span class="s2">&quot;GET &#39;about&#39;&quot;</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">&quot;should be successful&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">be_success</span>
    <span class="k">end</span>

    <span class="n">it</span> <span class="s2">&quot;should have the right title&quot;</span> <span class="k">do</span>
      <span class="n">get</span> <span class="s1">&#39;about&#39;</span>
      <span class="n">response</span><span class="o">.</span><span class="n">should</span> <span class="n">have_selector</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">,</span>
                                    <span class="ss">:content</span> <span class="o">=&gt;</span> <span class="vi">@base_title</span> <span class="o">+</span> <span class="s2">&quot; | About&quot;</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:gemfile_autotest"></div>


<div class="codelisting">
<div class="listing"><span class="header">Listing 3.34.</span> <span class="description">Adding Autotest to the <code>Gemfile</code>.</span>       
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.9&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.3&#39;</span>

<span class="n">group</span> <span class="ss">:development</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.6.1&#39;</span>
<span class="k">end</span>

<span class="n">group</span> <span class="ss">:test</span> <span class="k">do</span>
  <span class="n">gem</span> <span class="s1">&#39;rspec-rails&#39;</span><span class="p">,</span> <span class="s1">&#39;2.6.1&#39;</span>
  <span class="n">gem</span> <span class="s1">&#39;webrat&#39;</span><span class="p">,</span> <span class="s1">&#39;0.7.1&#39;</span>
  <span class="c1"># gem &#39;autotest&#39;, &#39;4.4.6&#39;</span>
  <span class="c1"># gem &#39;autotest-rails-pure&#39;, &#39;4.1.2&#39;</span>
  <span class="c1"># gem &#39;autotest-fsevent&#39;, &#39;0.2.4&#39;</span>
  <span class="c1"># gem &#39;autotest-growl&#39;, &#39;0.2.9&#39;</span>
<span class="k">end</span>
</pre></div>
</div></div>


<div class="navigation">  <a class="prev_page" href="a-demo-app#top">
    &laquo;&nbsp;<span class="number">Chapter 2</span> A demo app
  </a>
  <a class="next_page" href="rails-flavored-ruby#top">
    <span class="number">Chapter 4</span> Rails-flavored Ruby&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn:3.1">As before, you may find the augmented file from <a class="ref" href="beginning#code:gitignore">Listing&nbsp;1.6</a> to be more convenient depending on your system.&nbsp;<a class="arrow" href="#fnref:3.1">&uarr;</a></li>
<li id="fn:3.2">In fact, Rails ensures that requests for such files never hit the main Rails stack; they are delivered directly from the filesystem. (See <a href="http://www.amazon.com/gp/product/0321601661?ie=UTF8&amp;tag=httpwwwrailst-20&amp;linkCode=as2&amp;camp=1789&amp;creative=390957&amp;creativeASIN=0321601661"><em>The Rails&nbsp;3 Way</em></a> for more details.)&nbsp;<a class="arrow" href="#fnref:3.2">&uarr;</a></li>
<li id="fn:3.3">As usual, replace <code>mate</code> with the command for your text editor.&nbsp;<a class="arrow" href="#fnref:3.3">&uarr;</a></li>
<li id="fn:3.4">HTML changes with time; by explicitly making a doctype declaration we make it likelier that browsers will render our pages properly in the future. The extremely simple doctype <code>&lt;!DOCTYPE html&gt;</code> is characteristic of the latest HTML standard, HTML5.&nbsp;<a class="arrow" href="#fnref:3.4">&uarr;</a></li>
<li id="fn:3.5">Our method for making static pages is probably the simplest, but it&rsquo;s not the only way. The optimal method really depends on your needs; if you expect a <em>large</em> number of static pages, using a Pages controller can get quite cumbersome, but in our sample app we&rsquo;ll only need a few. See this <a href="http://blog.hasmanythrough.com/2008/4/2/simple-pages">blog post on simple pages at <tt>has_many :through</tt></a> for a survey of techniques for making static pages with Rails. <em>Warning:</em> the discussion is fairly advanced, so you might want to wait a while before trying to understand it.&nbsp;<a class="arrow" href="#fnref:3.5">&uarr;</a></li>
<li id="fn:3.6">In the context of RSpec, TDD is also known as Behavior Driven Development, or BDD. (Frankly, I&rsquo;m not convinced there&rsquo;s much of a difference.)&nbsp;<a class="arrow" href="#fnref:3.6">&uarr;</a></li>
<li id="fn:3.7">The <a href="http://github.com/thoughtbot/shoulda">Shoulda</a> testing framework is a good alternate choice (and in fact can be used with RSpec). It&rsquo;s the Other Rails Way, so to speak.&nbsp;<a class="arrow" href="#fnref:3.7">&uarr;</a></li>
<li id="fn:3.8">This used to be just <tt>autotest-rails</tt>, but that gem depends on the full ZenTest suite, which caused problems on some systems. The <tt>autotest-rails-pure</tt> gem avoids this dependency.&nbsp;<a class="arrow" href="#fnref:3.8">&uarr;</a></li>
<li id="fn:3.9">These gems should properly be included in the <code>Gemfile</code> rather than installed at the command line, but in that case the <code>Gemfile</code> would be system-dependent&mdash;a situation I&rsquo;d rather avoid in this tutorial. Incorporating Autotest into the <code>Gemfile</code> is left as an exercise (<a class="ref" href="static-pages#sec:static_pages_exercises">Section&nbsp;3.5</a>).&nbsp;<a class="arrow" href="#fnref:3.9">&uarr;</a></li>
<li id="fn:3.10">The Autotest Growl gem causes the test results to be automatically displayed to the monitor, whereas the FSEvent gem causes Autotest to use OS&nbsp;X filesystem events to trigger the test suite, rather than continuously polling the filesystem. Also note that with both gems you might need to use an updated version if you&rsquo;re running OS&nbsp;X Snow Leopard.&nbsp;<a class="arrow" href="#fnref:3.10">&uarr;</a></li>
<li id="fn:3.11">http://fredschoeneman.posterous.com/pimp-your-autotest-notification&nbsp;<a class="arrow" href="#fnref:3.11">&uarr;</a></li>
<li id="fn:3.12">In the context of RSpec, tests are often called <em>specs</em>, but for simplicity I&rsquo;ll usually stick to the term &ldquo;test&rdquo;&mdash;<em>except</em> when referring to a file such as <code>pages_controller_spec</code>, in which case I&rsquo;ll write &ldquo;Pages controller spec&rdquo;.&nbsp;<a class="arrow" href="#fnref:3.12">&uarr;</a></li>
<li id="fn:3.13">Most IDEs also have an interface to testing, but as noted in <a class="ref" href="beginning#sec:development_tools">Section&nbsp;1.2.1</a> I have limited experience with those tools.&nbsp;<a class="arrow" href="#fnref:3.13">&uarr;</a></li>
<li id="fn:3.14">You can also run <code>bundle exec rake spec</code>, which is basically equivalent. (Annoyingly, if you want to run <code>rake spec</code> here you have to run <code>rake db:migrate</code> first, even though the tests in this chapter don&rsquo;t require a database.)&nbsp;<a class="arrow" href="#fnref:3.14">&uarr;</a></li>
<li id="fn:3.15">A <em>spork</em> is a combination spoon-fork. My guess is that the project&rsquo;s name is a pun on Spork&rsquo;s use of <a href="http://en.wikipedia.org/wiki/POSIX">POSIX</a> <a href="http://en.wikipedia.org/wiki/Fork_(software_development)">forks</a>.&nbsp;<a class="arrow" href="#fnref:3.15">&uarr;</a></li>
<li id="fn:3.16">DRb stands for &ldquo;Distributed Ruby&rdquo;.&nbsp;<a class="arrow" href="#fnref:3.16">&uarr;</a></li>
<li id="fn:3.17">We&rsquo;ll learn in <a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">Section&nbsp;4.3.3</a> that the <code>:content =&gt; "&hellip;"</code> syntax is a <em>hash</em> using a <em>symbol</em> as the key.&nbsp;<a class="arrow" href="#fnref:3.17">&uarr;</a></li>
<li id="fn:3.18">I consider this a step back from RSpec&nbsp;1.3, which used <code>have_tag</code> in this context, which could be used to require an exact match. Unfortunately, as of this writing <code>have_tag</code> is not available in RSpec&nbsp;2.&nbsp;<a class="arrow" href="#fnref:3.18">&uarr;</a></li>
<li id="fn:3.19">A newline is what comes at the end of a line, starting a, well, new line. In code, it is represented by the character <tt class="verb">\n</tt>.&nbsp;<a class="arrow" href="#fnref:3.19">&uarr;</a></li>
<li id="fn:3.20">Actually <em>counting</em> columns could drive you crazy, which is why many text editors have a visual aid to help you. Consider TextMate, for example; if you take a look back at <a class="ref" href="beginning#fig:editor_shell">Figure&nbsp;1.1</a>, you&rsquo;ll see a small vertical line on the right to help keep code under 80 characters. (It&rsquo;s actually at 78 columns, which gives you a little margin for error.) If you use TextMate, you can find this feature under <tt>View &gt; Wrap Column &gt; 78</tt>.&nbsp;<a class="arrow" href="#fnref:3.20">&uarr;</a></li>
<li id="fn:3.21">Rails 2.3/RSpec 1.3, used the shorter <code>have_tag</code> instead of <code>have_selector</code>, and the <code>:content</code> argument wasn&rsquo;t necessary either. Newer isn&rsquo;t always better&hellip;&nbsp;<a class="arrow" href="#fnref:3.21">&uarr;</a></li>
<li id="fn:3.22">In fact, the instance variable is actually visible in <em>any</em> view, a fact we&rsquo;ll make use of in <a class="ref" href="sign-up#sec:a_working_form">Section&nbsp;8.2.2</a>.&nbsp;<a class="arrow" href="#fnref:3.22">&uarr;</a></li>
<li id="fn:3.23">There is a second popular template system called <a href="http://haml-lang.com/">Haml</a>, which I personally love, but it&rsquo;s not <em>quite</em> standard enough yet for use in an introductory tutorial. If there is sufficient interest, I might produce a Rails Tutorial screencast series using Haml for the views. This would also allow for an introduction to <a href="http://sass-lang.com/">Sass</a>, Haml&rsquo;s sister technology, which if anything is even more awesome than Haml.&nbsp;<a class="arrow" href="#fnref:3.23">&uarr;</a></li>
<li id="fn:3.24">If you&rsquo;ve studied Ruby before, you might suspect that Rails is <em>yielding</em> the contents to a block, and your suspicion would be correct. But, as far as developing web applications with Rails, it doesn&rsquo;t matter, and I&rsquo;ve honestly never given the meaning of <tt class="verb">&lt;%= yield %&gt;</tt> a second thought&mdash;or even a first one.&nbsp;<a class="arrow" href="#fnref:3.24">&uarr;</a></li>
</ol>
</div>




