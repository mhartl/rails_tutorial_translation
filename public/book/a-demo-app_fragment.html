<div id="top"></div>


<h1 class="chapter"><a id="sec:2" href="a-demo-app#top" class="heading"><span class="number">Глава 2</span> demo app</a></h1>


<p>В этой главе мы разработаем простое демонстрационное приложение, чтобы показать мощь Rails. Цель -  получить общее представление о программировании на Ruby on Rails (и веб-разработке в целом), быстро сгенерировав приложение, используя <em>scaffold generators</em>.<sup class="footnote" id="fnref:2.1"><a href="#fn:2.1">1</a></sup> Как обсуждалось в  <a class="ref" href="beginning#sidebar:scaffolding">Блоке&nbsp;1.1</a>, остальная часть книги будет применять противоположный подход, постепенно разрабатывая приложение с объяснением всех новых понятий по мере их появления,  но для быстрого обзора (и некоторого быстрорастворимого удовлетворения) нет ничего лучше чем scaffolding. Конечное  демонстрационное приложение позволит нам взаимодействовать с ним через свой URL, дав нам понимание структуры Rails приложений, включая первый пример <em>REST архитектуры</em> предпочитаемой Rails.</p>

<p>Как и предстоящий пример приложения, демонстрационное приложение будет состоять из <em>пользователей</em> и связанных с ними <em>микросообщений</em> (образуя минималистичное приложение в стиле Twitter). Функциональность будет совершенно слаборазвита и многие из шагов будут походить на волшебство, но не переживайте: полный пример приложения разработает подобное же приложение с нуля, начиная с <a class="ref" href="static-pages#top">Глава&nbsp;3</a>,  и я дам многочисленные ссылки на более поздний материал. Тем временем, имейте терпение и немного веры - все таки основная цель данного учебника - удержать вас  <em>вне</em> этого поверхностного, управляемого scaffold подхода, для достижения более глубокого понимания Rails.</p>

<div class="label" id="sec:planning_the_application"></div>


<h2><a id="sec:2.1" href="a-demo-app#sec:planning_the_application" class="heading"><span class="number">2.1</span> Планирование приложения</a></h2>


<p>В этом Разделе мы обрисуем в общих чертах наши планы относительно демонстрационного приложения. Как и в <a class="ref" href="beginning#sec:the_first_application">Разделе&nbsp;1.2.3</a>, мы начнем с создания скелета приложения, используя команду <code>rails</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="nb">cd</span> ~/rails_projects
<span class="gp">$</span> rails new demo_app
<span class="gp">$</span> <span class="nb">cd </span>demo_app
</pre></div>
</div>


<p>Затем, мы используем текстовый редактор, чтобы обновить <code>Gemfile</code> необходимый Bundler, содержанием из <a class="ref" href="a-demo-app#code:demo_gemfile_sqlite_version_redux">Листинга&nbsp;2.1</a>.</p>

<div class="label" id="code:demo_gemfile_sqlite_version_redux"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.1.</span> <span class="description"><code>Gemfile</code> для демонстрационного приложения.</span>
</div>
<div class="code"><div class="highlight"><pre><span class="n">source</span> <span class="s1">&#39;http://rubygems.org&#39;</span>

<span class="n">gem</span> <span class="s1">&#39;rails&#39;</span><span class="p">,</span> <span class="s1">&#39;3.0.9&#39;</span>
<span class="n">gem</span> <span class="s1">&#39;sqlite3&#39;</span><span class="p">,</span> <span class="s1">&#39;1.3.3&#39;</span>
</pre></div>
</div></div>


<p>(Напомним из <a class="ref" href="beginning#sec:bundler">Раздела&nbsp;1.2.4</a> что вам , возможно, понадобится версия <tt>1.2.5 sqlite3-ruby</tt> gem если вы  используете OS&nbsp;X Leopard.) Затем мы устанавливаем и включаем гемы, используя <code>bundle</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle install
</pre></div>
</div>


<p>Наконец, мы инициализируем репозиторий Git и сделаем первую фиксацию (commit):<sup class="footnote" id="fnref:2.2"><a href="#fn:2.2">2</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git init
<span class="gp">$</span> git add .
<span class="gp">$</span> git commit -m <span class="s2">&quot;Initial commit&quot;</span>
</pre></div>
</div>


<div class="label" id="fig:create_demo_repo"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/create_demo_repo.png" alt="create_demo_repo" /></span></div><div class="caption"><span class="header">Рис. 2.1: </span><span class="description">Создание репозитория demo app на GitHub.&nbsp;<a href="http://railstutorial.org/images/figures/create_demo_repo-full.png">(полный размер)</a></span></div></div>


<p>Можно также дополнительно создать новый репозиторий (<a class="ref" href="a-demo-app#fig:create_demo_repo">Рис.&nbsp;2.1</a>) и отправить его в GitHub:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git remote add origin git@github.com:&lt;username&gt;/demo_app.git
<span class="gp">$</span> git push origin master
</pre></div>
</div>


<p>Теперь мы готовы начать делать само приложение. Типичный первый шаг, при разработке приложений это создание  <em>модели данных</em>, которая является изображением структур, необходимых нашему приложению. В нашем случае demo app будет упрощенным микроблогом: только пользователи и короткие (микро) сообщения. Таким образом, мы начнем с модели для <em>пользователей</em> приложения (<a class="ref" href="a-demo-app#sec:modeling_users">Раздел&nbsp;2.1.1</a>), затем мы добавим модель для <em>микросообщений</em> (<a class="ref" href="a-demo-app#sec:modeling_microposts">Раздел&nbsp;2.1.2</a>).</p>

<div class="label" id="sec:modeling_users"></div>


<h3><a id="sec:2.1.1" href="a-demo-app#sec:modeling_users" class="heading"><span class="number">2.1.1</span> Моделирование пользователей</a></h3>


<p>Вариантов для модели данных пользователя так же много, как много различных форм регистрации в сети; мы пойдем отчетливо минималистичным путем. У пользователей нашего demo app будет уникальный <code>целочисленный</code> идентификатор называемый <code>id</code>, публично видимое <code>имя </code> (тип - <code>string (строка)</code>), и <code>email</code> адрес  (также <code>string</code>) совпадающий с именем пользователя. Итоговая модель данных для пользователей представлена в <a class="ref" href="a-demo-app#fig:demo_user_model">Рис.&nbsp;2.2</a>.</p>

<div class="label" id="fig:demo_user_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_model.png" alt="demo_user_model" /></span></div><div class="caption"><span class="header">Рис. 2.2: </span><span class="description">Модель данных для пользователей.</span></div></div>


<p>Как мы увидим в <a class="ref" href="modeling-and-viewing-users-one#sec:database_migrations">Разделе&nbsp;6.1.1</a>, табличка <code>users</code> в <a class="ref" href="a-demo-app#fig:demo_user_model">Рис.&nbsp;2.2</a> соответствует <em>таблице</em> в базе данных, и <code>id</code>, <code>name</code>, и <code>email</code> атрибуты это <em>столбцы</em> в этой таблице.</p>

<div class="label" id="sec:modeling_microposts"></div>


<h3><a id="sec:2.1.2" href="a-demo-app#sec:modeling_microposts" class="heading"><span class="number">2.1.2</span> Моделирование микросообщений</a></h3>


<p>Ядро модели данных микросообщений даже проще чем для пользователей: микросообщение имеет только <code>id</code> и поле <code>content</code> для текста микросообщения (тип- <code>string</code>).<sup class="footnote" id="fnref:2.3"><a href="#fn:2.3">3</a></sup> Есть дополнительная сложность: мы хотим <em>связать</em> каждое микросообщение с определенным пользователем; мы выполним это, записывая <code>user_id</code> владельца сообщения. Результаты показаны в  <a class="ref" href="a-demo-app#fig:demo_micropost_model">Рис.&nbsp;2.3</a>.</p>

<div class="label" id="fig:demo_micropost_model"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_model.png" alt="demo_micropost_model" /></span></div><div class="caption"><span class="header">Рис. 2.3: </span><span class="description">Модель данных для микросообщений.</span></div></div>


<p>Мы увидим в <a class="ref" href="a-demo-app#sec:demo_user_has_many_microposts">Разделе&nbsp;2.3.3</a> (и более полно в <a class="ref" href="user-microposts#top">Главе&nbsp;11</a>) как этот <code>user_id</code> атрибут позволит нам кратко реализовать идею, что у пользователя потенциально есть много связанных с ним микросообщений.</p>

<div class="label" id="sec:demo_users_resource"></div>


<h2><a id="sec:2.2" href="a-demo-app#sec:demo_users_resource" class="heading"><span class="number">2.2</span> Ресурс Users</a></h2>


<p>В этом разделе мы реализуем модель данных пользователей из <a class="ref" href="modeling_users#sec:modeling_users">Раздела&nbsp;2.1.1</a>, наряду с веб-интерфейсом к этой модели. Эта комбинация образует <em>ресурс Users</em>, который позволит нам думать о пользователях как об объектах, которые могут быть созданы, считаны, обновлены, и удалены через сеть с использованием <a   href="http://ru.wikipedia.org/wiki/HTTP-протокол">HTTP протокола</a>.</p>

<p>Как обещалось во введении, наш ресурс Users будет создаваться программой scaffold generator, которая стандартно поставляется с каждым проектом Rails. Аргумент команды <code>scaffold</code> это имя ресурса в единственном числе (в данном случае, <code>User</code>), вместе с дополнительными параметрами для атрибутов модели данных:<sup class="footnote" id="fnref:2.4"><a href="#fn:2.4">4</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate scaffold User name:string email:string
<span class="go">      invoke  active_record</span>
<span class="go">      create    db/migrate/20100615004000_create_users.rb</span>
<span class="go">      create    app/models/user.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/unit/user_test.rb</span>
<span class="go">      create      test/fixtures/users.yml</span>
<span class="go">       route  resources :users</span>
<span class="go">      invoke  scaffold_controller</span>
<span class="go">      create    app/controllers/users_controller.rb</span>
<span class="go">      invoke    erb</span>
<span class="go">      create      app/views/users</span>
<span class="go">      create      app/views/users/index.html.erb</span>
<span class="go">      create      app/views/users/edit.html.erb</span>
<span class="go">      create      app/views/users/show.html.erb</span>
<span class="go">      create      app/views/users/new.html.erb</span>
<span class="go">      create      app/views/users/_form.html.erb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/functional/users_controller_test.rb</span>
<span class="go">      invoke    helper</span>
<span class="go">      create      app/helpers/users_helper.rb</span>
<span class="go">      invoke      test_unit</span>
<span class="go">      create        test/unit/helpers/users_helper_test.rb</span>
<span class="go">      invoke  stylesheets</span>
<span class="go">      create    public/stylesheets/scaffold.css</span>
</pre></div>
</div>


<p>Добавив <code>name:string</code> и <code>email:string</code>, мы добились того, что модель User приобрела форму из <a class="ref" href="a-demo-app#fig:demo_user_model">Рис.&nbsp;2.2</a>. (Отметьте, что нет надобности включать параметр для <code>id</code>; он создается Rails автоматически.<sup class="footnote" id="fnref:2.5"><a href="#fn:2.5">5</a></sup>)</p>

<p>Чтобы продолжить с демонстрационным приложением, мы сначала должны <em>migrate (мигрировать, переместить)</em> базу данных, используя <em>Rake</em> (<a class="ref" href="a-demo-app#sidebar:rake">Блок&nbsp;2.1</a>):</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake db:migrate
<span class="go">==  CreateUsers: migrating ====================================================</span>
<span class="go">-- create_table(:users)</span>
<span class="go">   -&gt; 0.0017s</span>
<span class="go">==  CreateUsers: migrated (0.0018s) ===========================================</span>
</pre></div>
</div>


<p>Это просто обновляет базу данных с нашей новой моделью данных <code>users</code>. (Мы узнаем больше о миграциях баз данных в <a class="ref" href="modeling-and-viewing-users-one#sec:database_migrations">Разделе&nbsp;6.1.1</a>.) Отметьте, что для того, чтобы обеспечить использование версии Rake, соответствующей нашему <code>Gemfile</code>, нам необходимо запустить <code>rake</code> используя <code>bundle exec</code>. В <a class="ref" href="static-pages#sec:TDD">Разделе&nbsp;3.2.2</a> мы узнаем как сделать эту конструкцию более компактной.</p>

<p>Теперь мы можем запустить локальный веб-сервер, используя <code>rails s</code>, что является сокращением для <code>rails server</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails s
</pre></div>
</div>


<p>При этом демонстрационное приложение уже должно быть готово по адресу <a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a>.</p>

<div class="label" id="sidebar:rake"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 2.1.</span><span class="description">Rake</span></span>
<p>В традиции Unix, <a  href="http://ru.wikipedia.org/wiki/Make"><em>make</em></a> утилита играет важную роль в сборке исполняемых программ из исходного кода; множество компьютерных хакеров зафиксировали в мышечной памяти строку</p>

<pre class="verbatim">  $ ./configure &amp;&amp; make &amp;&amp; sudo make install</pre>


<p>обычно используемую, для компиляции кода на Unix системах (включая Linux и Mac OS&nbsp;X).</p>

<p>Rake это <em>Ruby make</em>, make-подобный язык написанный на Ruby. Rails использует Rake, в значительной степени, специально для неисчислимых небольших административных задач, необходимых при разработке поддерживаемых базой данных веб-приложений. <code>rake db:migrate</code> команда, вероятно, наиболее распространена, но есть и многие другие; можно увидеть список задач базы данных, используя <code>-T db</code>:</p>

<pre class="verbatim">$ bundle exec rake -T db</pre>


<p>Чтобы увидеть все доступные Rake задачи, запустите</p>

<pre class="verbatim">$ bundle exec rake -T</pre>


<p>Список, вероятно, будет подавляющим, но не волнуйтесь, вы  не должны знать все (или даже большую часть) этих команд. К концу  <em>Учебника Rails</em>, вы  будете знать все самые важные.</p>
</div>




<div class="label" id="sec:a_user_tour"></div>


<h3><a id="sec:2.2.1" href="a-demo-app#sec:a_user_tour" class="heading"><span class="number">2.2.1</span> Обзор пользователя</a></h3>


<p>При посещении корневого url&nbsp;<a href="http://localhost:3000/"><tt>http://localhost:3000/</tt></a> мы видим ту же самую дефолтную страницу Rails, что и на <a class="ref" href="beginning#fig:riding_rails_3">Рис.&nbsp;1.3</a>, но при генерировании ресурса Users scaffolding-ом мы также создали большое количество страниц для управления пользователями. Например, страницу для отображения списка всех пользователей в  <a href="http://localhost:3000/users">/users</a>, и страницу для создания нового пользователя в  <a href="http://localhost:3000/">/users/new</a>.<sup class="footnote" id="fnref:2.6"><a href="#fn:2.6">6</a></sup> Остальная часть этого Раздела, выделяется предпринятию ураганного тура через эти страницы пользователя (user). Поскольку мы продолжаем, полезно обратиться к <a class="ref" href="a-demo-app#table:user_urls">Table&nbsp;2.1</a>, которая показывает соответствие между страницами и URL.</p>

<div class="label" id="table:user_urls"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Action</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><a href="http://localhost:3000/users"><tt>/users</tt></a></td><td class="align_left"><code>index</code></td><td class="align_left">страница, для отображения списка всех пользователей</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1"><tt>/users/1</tt></a></td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая пользователя с id <code>1</code></td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/new"><tt>/users/new</tt></a></td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового пользователя</td></tr><tr><td class="align_left"><a href="http://localhost:3000/users/1/edit"><tt>/users/1/edit</tt></a></td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования пользователя с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.1: </span><span class="description">Cоответствие между страницами и URL для ресурса Users.</span></div></div>


<p>Мы начнем со страницы показывающей всех пользователей в нашем приложении, названной <a href="http://localhost:3000/users"><tt>index</tt></a>; как вы могли бы ожидать, изначально там нет никаких пользователей (<a class="ref" href="a-demo-app#fig:demo_blank_user_index_rails_3">Рис.&nbsp;2.4</a>).</p>

<div class="label" id="fig:demo_blank_user_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_blank_user_index_rails_3.png" alt="demo_blank_user_index_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.4: </span><span class="description">Начальная index страница для ресурса Users (<a href="http://localhost:3000/users"><tt>/users</tt></a>).&nbsp;<a href="/images/figures/demo_blank_user_index_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Чтобы создать нового пользователя, мы посещаем <a href="http://localhost:3000/users/new"><tt>new</tt></a> страницу, как показано на <a class="ref" href="a-demo-app#fig:demo_new_user_rails_3">Рис.&nbsp;2.5</a>. (В <a class="ref" href="sign-up#top">Главе&nbsp;8</a>, это станет страницей регистрации пользователя.)</p>

<div class="label" id="fig:demo_new_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_user_rails_3.png" alt="demo_new_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.5: </span><span class="description">Страница new user (<a href="http://localhost:3000/users/new"><tt>/users/new</tt></a>).&nbsp;<a href="/images/figures/demo_new_user_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Мы можем создать пользователя, введя значения имени и адреса электронной почты в текстовые поля и нажав затем кнопку Create User. Результат - страница <a href="http://localhost:3000/users/1"><tt>показывающая</tt></a> пользователя, как видно на <a class="ref" href="a-demo-app#fig:demo_show_user_rails_3">Рис.&nbsp;2.6</a>. (Зеленое приглашающее сообщение выполняется, с использованием <em>флэш</em>, о котором мы узнаем в <a class="ref" href="sign-up#sec:the_flash">Разделе&nbsp;8.3.3</a>.) Отметим, что в URL <a href="http://localhost:3000/users/1"><tt>/users/1</tt></a>; как вы  могли бы подозревать, цифра&nbsp;<code>1</code> это просто атрибут <code>id</code> пользователя из  <a class="ref" href="a-demo-app#fig:demo_user_model">Рис.&nbsp;2.2</a>. В <a class="ref" href="modeling-and-viewing-users-two#sec:better_user_views">Разделе&nbsp;7.3</a> эта страница станет профилем пользователя.</p>

<div class="label" id="fig:demo_show_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_show_user_rails_3.png" alt="demo_show_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.6: </span><span class="description">Страница показывающая пользователя (<a href="http://localhost:3000/users/1"><tt>/users/1</tt></a>).&nbsp;<a href="/images/figures/demo_show_user_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Для того, чтобы изменить информацию пользователя, мы посещаем страницу <a href="http://localhost:3000/users/1/edit"><tt>edit</tt></a>  (<a class="ref" href="a-demo-app#fig:demo_edit_user_rails_3">Рис.&nbsp;2.7</a>). Изменяя информацию о пользователе и нажимая кнопку Update, мы изменяем информацию о пользователя в демонстрационном приложении (<a class="ref" href="a-demo-app#fig:demo_update_user_rails_3">Рис.&nbsp;2.8</a>). (Как мы увидим в <a class="ref" href="modeling-and-viewing-users-one#top">Главе&nbsp;6</a>, эти данные пользователя хранятся в бэкэнде базы данных.) Мы добавим функции edit/update (редактировать/обновить) пользователя к примеру приложения в  <a class="ref" href="updating-showing-and-deleting-users#sec:updating_users">Разделе&nbsp;10.1</a>.</p>

<div class="label" id="fig:demo_edit_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_edit_user_rails_3.png" alt="demo_edit_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.7: </span><span class="description">Страница  редактирования пользователя (<a href="http://localhost:3000/users/1/edit"><tt>/users/1/edit</tt></a>).&nbsp;<a href="/images/figures/demo_edit_user_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="fig:demo_update_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_update_user_rails_3.png" alt="demo_update_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.8: </span><span class="description">Пользователь с обновленной информацией.&nbsp;<a href="/images/figures/demo_update_user_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Теперь мы создадим второго пользователя, повторно посетив <a href="http://localhost:3000/users/new"><tt>new</tt></a> страницу и предоставив второй набор информации о пользователе; получившаяся страница <a href="http://localhost:3000/users"><tt>index</tt></a> показана на <a class="ref" href="a-demo-app#fig:demo_user_index_two_rails_3">Рис.&nbsp;2.9</a>. <a class="ref" href="updating-showing-and-deleting-users#sec:showing_users">Раздел&nbsp;10.3</a> преобразует index пользователя в более отполированную страницу для демонстрации всех пользователей.</p>

<div class="label" id="fig:demo_user_index_two_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_user_index_two_rails_3.png" alt="demo_user_index_two_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.9: </span><span class="description">index страница пользователя (<a href="http://localhost:3000/users"><tt>/users</tt></a>) со вторым пользователем.&nbsp;<a href="/images/figures/demo_user_index_two_rails_3-full.png">(полный размер)</a></span></div></div>


<p>Показав, как создавать, отображать и редактировать пользователей, мы переходим, наконец, к их уничтожению (<a class="ref" href="a-demo-app#fig:demo_destroy_user_rails_3">Рис.&nbsp;2.10</a>). Следует проверить, что клик по ссылке <a class="ref" href="a-demo-app#fig:demo_destroy_user_rails_3">Рис.&nbsp;2.10</a> уничтожает второго пользователя, приводя к index странице с одним пользователем. (Если это не работает, убедитесь, что JavaScript включен в вашем браузере; Rails использует JavaScript, чтобы выдать запрос, который должен уничтожить пользователя.) <a class="ref" href="updating-showing-and-deleting-users#sec:destroying_users">Раздел&nbsp;10.4</a> добавляет удаление пользователя к демонстрационному приложению, заботясь об ограничении его использования специальным классом административных пользователей.</p>

<div class="label" id="fig:demo_destroy_user_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_destroy_user_rails_3.png" alt="demo_destroy_user_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.10: </span><span class="description">Уничтожение пользователя.&nbsp;<a href="/images/figures/demo_destroy_user_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec:mvc_in_action"></div>


<h3><a id="sec:2.2.2" href="a-demo-app#sec:mvc_in_action" class="heading"><span class="number">2.2.2</span> MVC в действии</a></h3>


<p>Теперь, когда мы завершили быстрый обзор ресурса Пользователи (Users), давайте исследуем одну его определенную часть в контексте паттерна Модель-Представление-Контроллер (MVC) частично представленного в <a class="ref" href="beginning#sec:mvc">Разделе&nbsp;1.2.6</a>. Наша стратегия будет состоять в том, чтобы описать результаты типичного запроса браузера: посещение index страницы пользователя на <a href="http://localhost:3000/users">/users</a>&mdash;в терминах MVC (<a class="ref" href="a-demo-app#fig:mvc_detailed">Рис.&nbsp;2.11</a>).</p>

<div class="label" id="fig:mvc_detailed"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/mvc_detailed.png" alt="mvc_detailed" /></span></div><div class="caption"><span class="header">Рис. 2.11: </span><span class="description">Подробная схема MVC в Rails.&nbsp;<a href="/images/figures/mvc_detailed-full.png">(полный размер)</a></span></div></div>




<ol><li>Браузер выдает запрос на URL <tt>/users</tt>.</li>
<li>Rails направляет <tt>/users</tt> к <code>index</code> действию в контроллере Users (Пользователи)</li>
<li> <code>Index</code> действие просит, чтобы модель User получила всех пользователей (<code>User.all</code>).</li>
<li>Модель User получает по запросу всех пользователей из базы данных.</li>
<li>Модель User возвращает список пользователей в контроллер.</li>
<li>Контроллер получает пользователей в <code>@users</code> переменной, которую он передает <code>index</code> представлению.</li>
<li>Представление использует Embedded (Встроенный) Ruby, чтобы визуализировать страницу как HTML.</li>
<li>Контроллер возвращает HTML в браузер. <sup class="footnote" id="fnref:2.7"><a href="#fn:2.7">7</a></sup></li>
</ol>


<p>Мы начинаем с запроса, выданного браузером &mdash; то есть, с результата ввода URL в адресной строке или клика по ссылке (Шаг&nbsp;1 в <a class="ref" href="a-demo-app#fig:mvc_detailed">Рис.&nbsp;2.11</a>). Этот запрос вызывает <em>Rails маршрутизатор</em> (Шаг&nbsp;2), который отправляет к  надлежащему <em>действию контроллера</em>, основываясь на URL (и, как мы увидим в <a class="ref" href="static-pages#sidebar:get_etc">Блоке&nbsp;3.1</a>, на типе запроса). Код создающий перенаправление URL пользователя к действиям контроллера для ресурса Users представлен в <a class="ref" href="a-demo-app#code:rails_routes">Листинге&nbsp;2.2</a>;<sup class="footnote" id="fnref:2.8"><a href="#fn:2.8">8</a></sup> этот код  фактически устанавливает таблицу пар URL/Действие, которые мы видели в  <a class="ref" href="a-demo-app#table:user_urls">Таблице&nbsp;2.1</a>.</p>

<div class="label" id="code:rails_routes"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.2.</span> <span class="description">Маршруты Rails, с правилом для ресурса Users. <br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="no">DemoApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Страницы из <a class="ref" href="a-demo-app#sec:a_user_tour">Раздела&nbsp;2.2.1</a> соответствуют <em>действиям</em> в <em>контроллере</em> Users, который является набором связанных действий; контроллер, сгенерированный scaffolding,  схематично показан в <a class="ref" href="a-demo-app#code:demo_users_controller">Листинге&nbsp;2.3</a>. Отметьте запись <code>class UsersController &lt; ApplicationController</code>; это  пример Ruby <em>класса</em> с <em>наследованием</em>. (Мы  вкратце обсудим наследование в <a class="ref" href="a-demo-app#sec:inheritance_hierarchies">Разделе&nbsp;2.3.4</a> и охватим обе темы более подробно в <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">Разделе&nbsp;4.4</a>.)</p>

<div class="label" id="code:demo_users_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.3.</span> <span class="description">Контроллер Users в схематичной форме. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Вы могли заметить, что действий больше чем страниц; <code>index</code>, <code>show</code>, <code>new</code>, и <code>edit</code> действия - все они соответствуют страницам из <a class="ref" href="a-demo-app#sec:a_user_tour">Раздела&nbsp;2.2.1</a>, но есть также дополнительные <code>create</code> (создать), <code>update</code> (обновить), и <code>destroy</code> (разрушить) действия. Эти действия обычно не визуализируют страницы (хотя иногда могут); вместо этого, их основная цель состоит в том, чтобы изменять информацию о пользователях в базе данных. Этот полный комплект действий контроллера, сведенный в  <a class="ref" href="a-demo-app#table:demo_RESTful_users">Таблицу&nbsp;2.2</a>, представляет реализацию архитектуры REST в Rails (<a class="ref" href="a-demo-app#sidebar:REST">Блок&nbsp;2.2</a>). Отметьте в <a class="ref" href="a-demo-app#table:demo_RESTful_users">Таблице&nbsp;2.2</a> что есть некоторое наложение в URL; например, и <code>show</code> и <code>update</code> действиям соответствует URL <tt>/users/1</tt>. Различие между ними в <a  rel="nofollow" href="http://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">методе запроса HTTP</a> на который они отвечают. Мы узнаем больше о методах запроса HTTP в  <a class="ref" href="static-pages#sec:TDD">Разделе&nbsp;3.2.2</a>.</p>

<div class="label" id="table:demo_RESTful_users"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users</tt></td><td class="align_left"><code>index</code></td><td class="align_left">страница со списком всех пользователей</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/new</tt></td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового пользователя</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left"><tt>/users</tt></td><td class="align_left"><code>create</code></td><td class="align_left">создание нового пользователя</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/users/1/edit</tt></td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>update</code></td><td class="align_left">обновление пользователя с id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left"><tt>/users/1</tt></td><td class="align_left"><code>destroy</code></td><td class="align_left">удаление пользователя с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.2: </span><span class="description">RESTful маршруты, обеспеченные ресурсом Users в <a class="ref" href="a-demo-app#code:rails_routes">Листинге&nbsp;2.2</a>.</span></div></div>




<div class="label" id="sidebar:REST"></div>


<div class="sidebar"><span class="title"><span class="header">Блок 2.2.</span><span class="description">REST (REpresentational State Transfer, (</a href="http://ru.wikipedia.org/wiki/REST">«передача состояния представления»</a>))</span></span>
<p>Если вы  много читали о веб-разработке на Ruby on Rails, вы  видели много ссылок на “REST”, являющуюся акронимом для REpresentational State Transfer («передача состояния представления»). REST - архитектурный стиль для разработки распределенных, сетевых систем и приложений, таких как World Wide Web и веб-приложения. Хотя теория REST довольно абстрактна, в контексте Rails приложений REST означает, что большинство компонентов приложения (таких как пользователи и микросообщения) моделируются как <em>ресурсы</em>, которые могут быть созданы (Сreated), прочитаны (Read), обновлены (Updated), и удалены (Deleted) - операции, которые соответствуют и <a href="http://ru.wikipedia.org/wiki/CRUD">операциям CRUD, реляционных баз данных</a> и четырем фундаментальным <a href="http://ru.wikipedia.org/wiki/HTTP#.D0.9C.D0.B5.D1.82.D0.BE.D0.B4.D1.8B">методам запроса HTTP</a>: <tt>POST</tt>, <tt>GET</tt>, <tt>PUT</tt>, и <tt>DELETE</tt>. (Мы узнаем больше о запросах HTTP в <a class="ref" href="static-pages#sec:TDD">Разделе&nbsp;3.2.2</a> и особенно в <a class="ref" href="static-pages#sidebar:get_etc">Блоке&nbsp;3.1</a>.)</p>

<p>Как разработчику Rails приложений, RESTful  стиль разработки помогает вам  сделать выбор о том, какие контроллеры и действия написать: вы  просто структурируете приложение, используя ресурсы, которые создаются, читаются, обновляются, и удаляются. В случае пользователей и микросообщений, этот процесс является простым, так как они - натуральные ресурсы по определению. В <a class="ref" href="following-users#top">Главе&nbsp;12</a> мы увидим пример, где принципы REST позволяют нам моделировать более тонкую проблему &ldquo;Слежения за сообщениями пользователей&rdquo; естественным и удобным способом.</p>
</div>


<p>Чтобы исследовать отношения между контроллером Users и моделью User, давайте сосредоточимся на упрощенной версии <code>index</code> действия, показанной в <a class="ref" href="a-demo-app#code:demo_index_action">Листинге&nbsp;2.4</a>.<sup class="footnote" id="fnref:2.9"><a href="#fn:2.9">9</a></sup></p>

<div class="label" id="code:demo_index_action"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.4.</span> <span class="description">Упрощенное index  действие для демонстрационного приложения. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="vi">@users</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">all</span>
  <span class="k">end</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>У этого <code>index</code> действия есть строка <code>@users = User.all</code> (Шаг&nbsp;3), которая просит, чтобы модель User получила список всех пользователей из базы данных (Шаг&nbsp;4), и затем помещает их в переменную  <code>@users</code> (произносится &ldquo;at-users&rdquo;) (Шаг&nbsp;5). Сама модель User  появляется в  <a class="ref" href="a-demo-app#code:demo_user_model">Листинге&nbsp;2.5</a>; хотя она довольно проста, к ней прилагается большое количество функций из-за наследования  (<a class="ref" href="a-demo-app#sec:inheritance_hierarchies">Раздел&nbsp;2.3.4</a> и <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">Раздел&nbsp;4.4</a>). В частности, за счет использования Rails библиотеки <em>Active Record</em>, код в  <a class="ref" href="a-demo-app#code:demo_user_model">Листинге&nbsp;2.5</a> заставляет <code>User.all</code> возвратить всех пользователей.</p>

<div class="label" id="code:demo_user_model"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.5.</span> <span class="description">Модель User для демонстрационного приложения. <br /> <code>app/models/user.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Как только <code>@users</code> переменная определена, контроллер вызывает <em>представление </em> (Шаг&nbsp;6), показанное в <a class="ref" href="a-demo-app#code:demo_index_view">Листинге&nbsp;2.6</a>. Переменные, которые начинаются со знака <code>@</code>, называемые <em>переменными экземпляра</em>, автоматически доступны в представлении; в данном случае, представление <code>index.html.erb</code> в  <a class="ref" href="a-demo-app#code:demo_index_view">Листинге&nbsp;2.6</a> перебирает  список <code>@users</code> и выводит строку HTML для каждого.<sup class="footnote" id="fnref:2.10"><a href="#fn:2.10">10</a></sup></p>

<div class="label" id="code:demo_index_view"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.6.</span> <span class="description">Представление для user index.<br /> <code>app/views/users/index.html.erb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="nt">&lt;h1&gt;</span>Листинг users<span class="nt">&lt;/h1&gt;</span>

<span class="nt">&lt;table&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th&gt;</span>Name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Email<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>

<span class="cp">&lt;%</span> <span class="vi">@users</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">user</span><span class="o">|</span> <span class="cp">%&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">name</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Show&#39;</span><span class="p">,</span> <span class="n">user</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Edit&#39;</span><span class="p">,</span> <span class="n">edit_user_path</span><span class="p">(</span><span class="n">user</span><span class="p">)</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
    <span class="nt">&lt;td&gt;</span><span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;Destroy&#39;</span><span class="p">,</span> <span class="n">user</span><span class="p">,</span> <span class="ss">:confirm</span> <span class="o">=&gt;</span> <span class="s1">&#39;Are you sure?&#39;</span><span class="p">,</span>
<span class="ss">:method</span> <span class="o">=&gt;</span> <span class="ss">:delete</span> <span class="cp">%&gt;</span><span class="nt">&lt;/td&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span>
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;br</span> <span class="nt">/&gt;</span>

<span class="cp">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;New User&#39;</span><span class="p">,</span> <span class="n">new_user_path</span> <span class="cp">%&gt;</span>
</pre></div>
</div></div>


<p>Представление преобразует свое содержание в HТML (Шаг&nbsp;7), который затем возвращается контроллером в браузер для отображения (Шаг&nbsp;8).</p>

<div class="label" id="sec:weaknesses_of_this_users_resource"></div>


<h3><a id="sec:2.2.3" href="a-demo-app#sec:weaknesses_of_this_users_resource" class="heading"><span class="number">2.2.3</span> Недостатки данного Users ресурса</a></h3>


<p>Несмотря на полезность для общего обзора Rails, scaffold-ный ресурс Users имеет много серьезных недостатков.</p>

<ul><li><strong>Нет валидации данных.</strong> Наша модель User  безропотно принимает такие данные как пустые имена и недопустимые адреса электронной почты.</li>
<li><strong>Нет аутентификации.</strong> У нас нет понятия регистрации, и нет способа воспрепятствовать тому, чтобы любой пользователь выполнил любую операцию.</li>
<li><strong>Нет тестов.</strong> Что, технически, не вполне верно &mdash; scaffolding включает рудиментарные тесты &mdash; но сгенерированные тесты уродливы и негибки, и они не тестируют на подтверждение правильности данных, аутентификацию, или какие нибудь другие пользовательские потребности.</li>
<li><strong>Нет макета.</strong> Нет сколь-нибудь связанного стиля сайта или навигации.</li>
<li><strong>Нет реального понимания.</strong> Если вы понимаете код scaffold, вам, вероятно, не стОит читать эту книгу.</li></ul>




<div class="label" id="sec:microposts_resource"></div>


<h2><a id="sec:2.3" href="a-demo-app#sec:microposts_resource" class="heading"><span class="number">2.3</span> Ресурс Microposts</a></h2>


<p>Сгенерировав и исследовав ресурс Users, мы поворачиваемся теперь к связанному ресурсу Microposts. На протяжении этого раздела я рекомендую сравнивать элементы ресурса Microposts с аналогичными элементами User из  <a class="ref" href="a-demo-app#sec:demo_users_resource">Раздела&nbsp;2.2</a>; вы должны увидеть, что эти два ресурса во многом параллельны друг другу. RESTful структура Rails приложений лучше всего усваивается посредством наблюдения за подобными повторяющимися формами; действительно, наблюдение параллельной структуры Users и Microposts даже на этой ранней стадии является одной из причин написания этой главы. (Как мы увидим, написание приложения, более устойчивого, нежели игрушечный пример в этой главе, требует значительных усилий &mdash; мы не увидим ресурс Microposts до  <a class="ref" href="user-microposts#top">Главы&nbsp;11</a>&mdash; и я не хотел так надолго откладывать его первое появление.)</p>

<div class="label" id="sec:a_micropost_microtour"></div>


<h3><a id="sec:2.3.1" href="a-demo-app#sec:a_micropost_microtour" class="heading"><span class="number">2.3.1</span> Микрообзор микросообщений</a></h3>


<p>Как и с ресурсом Users, мы генерируем код scaffold для ресурса Microposts, используя <code>rails generate scaffold</code>, в этом случае реализуя модель данных из <a class="ref" href="a-demo-app#fig:demo_micropost_model">Рис.&nbsp;2.3</a>:<sup class="footnote" id="fnref:2.11"><a href="#fn:2.11">11</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> rails generate scaffold Micropost content:string user_id:integer
<span class="go">      invoke  active_record</span>
<span class="go">      create    db/migrate/20100615004429_create_microposts.rb</span>
<span class="go">      create    app/models/micropost.rb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/unit/micropost_test.rb</span>
<span class="go">      create      test/fixtures/microposts.yml</span>
<span class="go">       route  resources :microposts</span>
<span class="go">      invoke  scaffold_controller</span>
<span class="go">      create    app/controllers/microposts_controller.rb</span>
<span class="go">      invoke    erb</span>
<span class="go">      create      app/views/microposts</span>
<span class="go">      create      app/views/microposts/index.html.erb</span>
<span class="go">      create      app/views/microposts/edit.html.erb</span>
<span class="go">      create      app/views/microposts/show.html.erb</span>
<span class="go">      create      app/views/microposts/new.html.erb</span>
<span class="go">      create      app/views/microposts/_form.html.erb</span>
<span class="go">      invoke    test_unit</span>
<span class="go">      create      test/functional/microposts_controller_test.rb</span>
<span class="go">      invoke    helper</span>
<span class="go">      create      app/helpers/microposts_helper.rb</span>
<span class="go">      invoke      test_unit</span>
<span class="go">      create        test/unit/helpers/microposts_helper_test.rb</span>
<span class="go">      invoke  stylesheets</span>
<span class="go">   identical    public/stylesheets/scaffold.css</span>
</pre></div>
</div>


<p>Чтобы обновить нашу базу данных с новой моделью данных, мы должны запустить миграцию как в <a class="ref" href="a-demo-app#sec:demo_users_resource">Разделе&nbsp;2.2</a>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> bundle <span class="nb">exec </span>rake db:migrate
<span class="go">==  CreateMicroposts: migrating ===============================================</span>
<span class="go">-- create_table(:microposts)</span>
<span class="go">   -&gt; 0.0023s</span>
<span class="go">==  CreateMicroposts: migrated (0.0026s) ======================================</span>
</pre></div>
</div>


<p>Теперь мы имеем возможность создавать микропосты тем же образом, каким мы создавали пользователей в <a class="ref" href="a-demo-app#sec:a_user_tour">Разделе&nbsp;2.2.1</a>. Как вы могли бы предположить, генератор scaffold добавил в файл маршрутов Rails правило для ресурса Microposts, как видно в  <a class="ref" href="a-demo-app#code:demo_microposts_resource">Листинге&nbsp;2.7</a>.<sup class="footnote" id="fnref:2.12"><a href="#fn:2.12">12</a></sup> Как и с users, <code>resources :microposts</code> маршрутное правило направляет  URL микросообщений на действия в контроллере Microposts, как видно в  <a class="ref" href="a-demo-app#table:demo_RESTful_microposts">Таблице&nbsp;2.3</a>.</p>

<div class="label" id="code:demo_microposts_resource"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.7.</span> <span class="description">Маршруты Rails с новым правилом для ресурсов Microposts.<br /> <code>config/routes.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="no">DemoApp</span><span class="o">::</span><span class="no">Application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
  <span class="n">resources</span> <span class="ss">:microposts</span>
  <span class="n">resources</span> <span class="ss">:users</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="table:demo_RESTful_microposts"></div>


<div class="table"><div class="center"><table class="tabular"><tr><th class="align_left"><strong>HTTP запрос</strong></th><th class="align_left"><strong>URL</strong></th><th class="align_left"><strong>Действие</strong></th><th class="align_left"><strong>Назначение</strong></th></tr><tr class="top_bar"><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts</tt></td><td class="align_left"><code>index</code></td><td class="align_left">страница со списком всех микросообщений</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>show</code></td><td class="align_left">страница показывающая микросообщение с id <code>1</code></td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/new</tt></td><td class="align_left"><code>new</code></td><td class="align_left">страница для создания нового микросообщения</td></tr><tr><td class="align_left"><tt>POST</tt></td><td class="align_left"><tt>/microposts</tt></td><td class="align_left"><code>create</code></td><td class="align_left">создание нового микросообщения</td></tr><tr><td class="align_left"><tt>GET</tt></td><td class="align_left"><tt>/microposts/1/edit</tt></td><td class="align_left"><code>edit</code></td><td class="align_left">страница для редактирования микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>PUT</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>update</code></td><td class="align_left">обновление микросообщения с id <code>1</code></td></tr><tr><td class="align_left"><tt>DELETE</tt></td><td class="align_left"><tt>/microposts/1</tt></td><td class="align_left"><code>destroy</code></td><td class="align_left">удаление микросообщения с id <code>1</code></td></tr></table></div><div class="caption"><span class="header">Таблица 2.3: </span><span class="description">RESTful маршруты, обеспеченные ресурсом Microposts в <a class="ref" href="a-demo-app#code:demo_microposts_resource">Листинге&nbsp;2.7</a>.</span></div></div>


<p>Сам Microposts контроллер в схематичной форме представлен в <a class="ref" href="a-demo-app#code:demo_microposts_controller">Листинге&nbsp;2.8</a>. Отметьте, что, кроме наличия <code>MicropostsController</code> вместо <code>UsersController</code>, <a class="ref" href="a-demo-app#code:demo_microposts_controller">Листинг&nbsp;2.8</a> <em>идентичен</em> коду в <a class="ref" href="a-demo-app#code:demo_users_controller">Листинге&nbsp;2.3</a>. Это отражение REST архитектуры, характерной для обоих ресурсов.</p>

<div class="label" id="code:demo_microposts_controller"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.8.</span> <span class="description">Контроллер Microposts в схематичной форме. <br /> <code>app/controllers/microposts_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>

  <span class="k">def</span> <span class="nf">index</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">show</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">new</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">create</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">edit</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">update</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="nf">destroy</span>
    <span class="o">.</span>
    <span class="o">.</span>
    <span class="o">.</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Чтобы сделать несколько актуальных микросообщений, мы вводим информацию в new страницу микросообщений, <a href="http://localhost:3000/microposts/new">/microposts/new</a>, как видно на <a class="ref" href="a-demo-app#fig:demo_new_micropost_rails_3">Рис.&nbsp;2.12</a>.</p>

<div class="label" id="fig:demo_new_micropost_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_new_micropost_rails_3.png" alt="demo_new_micropost_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.12: </span><span class="description">Страница для создания микросообщений (<a href="http://localhost:3000/microposts/new">/microposts/new</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_new_micropost-full.png">(полный размер)</a></span></div></div>


<p>Создайте одно - два микросообщения,  удостоверьтесь, чтобы по крайней мере у одного был <code>user_id</code>&nbsp;=&nbsp;<code>1</code> для сопоставления с id первого пользователя, созданного в <a class="ref" href="a-demo-app#sec:a_user_tour">Разделе&nbsp;2.2.1</a>. Результат должен быть похож на <a class="ref" href="a-demo-app#fig:demo_micropost_index_rails_3">Рис.&nbsp;2.13</a>.</p>

<div class="label" id="fig:demo_micropost_index_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_micropost_index_rails_3.png" alt="demo_micropost_index_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.13: </span><span class="description"> Микропост index страница  (<a href="http://localhost:3000/microposts">/microposts</a>).&nbsp;<a href="http://railstutorial.org/images/figures/demo_micropost_index_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec:putting_the_micro_in_microposts"></div>


<h3><a id="sec:2.3.2" href="a-demo-app#sec:putting_the_micro_in_microposts" class="heading"><span class="number">2.3.2</span> Помещение <em>микро</em> в микросообщения</a></h3>


<p>Каждое <em>микро</em>сообщение, достойное своего имени, должно иметь некоторые средства предписания длины сообщения. Реализация этого ограничения в Rails легка с <em>проверками допустимости</em> (валидациями); чтобы принять микросообщения с, самое большее, 140 символами (а-ля Twitter), мы используем проверку допустимости (валидацию) <em>длины</em>. В этой точке следует открыть файл <code>app/models/micropost.rb</code> в вашем текстовом редакторе или IDE и заполнить его содержанием <a class="ref" href="a-demo-app#code:demo_length_validation">Листинга&nbsp;2.9</a>. (Использование <em>валидации</em> из <a class="ref" href="a-demo-app#code:demo_length_validation">Листинга&nbsp;2.9</a> характерно для Rails&nbsp;3; если вы ранее работали с Rails&nbsp;2.3, следует сравнить это с использованием <code>validates_length_of</code>.)</p>

<div class="label" id="code:demo_length_validation"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.9.</span> <span class="description">Ограничение микросообщений максимумом в 140 знаков посредством валидации длины.<br /> <code>app/models/micropost.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Код в <a class="ref" href="a-demo-app#code:demo_length_validation">Листинге&nbsp;2.9</a> может выглядеть, довольно таинственно &mdash; мы рассмотрим валидацию, более тщательно  в <a class="ref" href="modeling-and-viewing-users-one#sec:user_validations">Разделе&nbsp;6.2</a> &mdash; но его эффект, станет вполне очевиден, если мы перейдем в новую страницу микросообщений и введем больше чем 140 символов для контента сообщения. Как видно в <a class="ref" href="a-demo-app#fig:micropost_length_error_rails_3">Рис.&nbsp;2.14</a>, Rails выдает <em>сообщение об ошибке</em> указывающее на то, что контент микросообщения является слишком длинным. (Мы узнаем больше о сообщениях об ошибках в <a class="ref" href="sign-up#sec:signup_error_messages">Разделе&nbsp;8.2.3</a>.)</p>

<div class="label" id="fig:micropost_length_error_rails_3"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_length_error_rails_3.png" alt="micropost_length_error_rails_3" /></span></div><div class="caption"><span class="header">Рис. 2.14: </span><span class="description">Сообщение об ошибке для неудачно созданного микросообщения.&nbsp;<a href="http://railstutorial.org/images/figures/micropost_length_error_rails_3-full.png">(полный размер)</a></span></div></div>




<div class="label" id="sec:demo_user_has_many_microposts"></div>


<h3><a id="sec:2.3.3" href="a-demo-app#sec:demo_user_has_many_microposts" class="heading"><span class="number">2.3.3</span> A user <code>has_many</code> microposts (Пользователь <code>имеет_много</code> микросообщений)</a></h3>


<p>Одна из наиболее мощных функций Rails &#8211; возможность формировать <em>связи</em> между различными моделями данных. В случае нашей модели User  у каждого пользователя потенциально есть много микросообщений. Мы можем выразить это в коде, обновив модели User и Micropost как в <a class="ref" href="a-demo-app#code:demo_user_has_many_microposts">Листинге&nbsp;2.10</a> и <a class="ref" href="a-demo-app#code:demo_micropost_belongs_to_user">Листинге&nbsp;2.11</a>.</p>

<div class="label" id="code:demo_user_has_many_microposts"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.10.</span> <span class="description">У пользователя есть много микросообщений (user has many microposts). <br /> <code>app/models/user.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">has_many</span> <span class="ss">:microposts</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_micropost_belongs_to_user"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.11.</span> <span class="description">Микросообщения принадлежат пользователю (micropost belongs to a user).<br /> <code>app/models/micropost.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="n">belongs_to</span> <span class="ss">:user</span>

  <span class="n">validates</span> <span class="ss">:content</span><span class="p">,</span> <span class="ss">:length</span> <span class="o">=&gt;</span> <span class="p">{</span> <span class="ss">:maximum</span> <span class="o">=&gt;</span> <span class="mi">140</span> <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</div></div>


<p>Мы можем увидеть результат применения этой ассоциации на <a class="ref" href="a-demo-app#fig:micropost_user_association">Рис.&nbsp;2.15</a>. Из-за <code>user_id</code> столбца в таблице <code>microposts</code> Rails (используя Active Record) может вывести микросообщения, связанные с каждым пользователем.</p>

<div class="label" id="fig:micropost_user_association"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/micropost_user_association.png" alt="micropost_user_association" /></span></div><div class="caption"><span class="header">Рис. 2.15: </span><span class="description">Связь между микросообщениями и пользователями.</span></div></div>


<p>В  <a class="ref" href="user-microposts#top">Главе&nbsp;11</a> и <a class="ref" href="following-users#top">Главе&nbsp;12</a> мы будем использовать ассоциацию пользователей и микросообщений и чтобы вывести на экран все микросообщения пользователя, и чтобы создать Twitter-подобную подачу микросообщений. Пока, мы можем исследовать применение связи микросообщения-пользователь с помощью <em>консоли</em>, которая является полезным инструментом для взаимодействия с Rails приложениями. Сначала мы вызовем консоль командой <code>rails console</code> в командной строке, а затем получим первого пользователя из базы данных, используя <code>User.first</code> (поместив результаты в переменную <code>first_user</code>):<sup class="footnote" id="fnref:2.13"><a href="#fn:2.13">13</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="go">$ rails console</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">first</span>
<span class="go">=&gt; #&lt;User id: 1, name: &quot;Michael Hartl&quot;, email: &quot;michael@example.org&quot;,</span>
<span class="go">created_at: &quot;2010-04-03 02:01:31&quot;, updated_at: &quot;2010-04-03 02:01:31&quot;&gt;</span>
<span class="gp">&gt;&gt; </span><span class="n">first_user</span><span class="o">.</span><span class="n">microposts</span>
<span class="go">=&gt; [#&lt;Micropost id: 1, content: &quot;First micropost!&quot;, user_id: 1, created_at:</span>
<span class="go">&quot;2010-04-03 02:37:37&quot;, updated_at: &quot;2010-04-03 02:37:37&quot;&gt;, #&lt;Micropost id: 2,</span>
<span class="go">content: &quot;Second micropost&quot;, user_id: 1, created_at: &quot;2010-04-03 02:38:54&quot;,</span>
<span class="go">updated_at: &quot;2010-04-03 02:38:54&quot;&gt;]</span>
<span class="gp">&gt;&gt; </span><span class="nb">exit</span>
</pre></div>
</div>


<p>(Я включил последнюю строку только чтобы продемонстрировать, как выйти из консоли, и на большинстве систем вы можете использовать Ctrl-d с этой же целью.) Здесь мы получили доступ к микросообщениям пользователя, используя код <code>first_user.microposts</code>: с этим кодом Active Record автоматически возвращает все микросообщения с <code>user_id</code> равным id <code>first_user</code> (в данном случае,&nbsp;<code>1</code>). Мы узнаем намного больше о возможностях ассоциаций (связей) Active Record в  <a class="ref" href="user-microposts#top">Главе&nbsp;11</a> и <a class="ref" href="following-users#top">Главе&nbsp;12</a>.</p>

<div class="label" id="sec:inheritance_hierarchies"></div>


<h3><a id="sec:2.3.4" href="a-demo-app#sec:inheritance_hierarchies" class="heading"><span class="number">2.3.4</span> Иерархия наследования</a></h3>


<p>Мы закончим наше обсуждение демонстрационного приложения кратким описанием иерархии классов контроллеров и моделей в Rails. Это обсуждение будет иметь много смысла, только если у вас был некоторый опыт объектно-ориентированного программирования (ООП); если вы не изучали ООП, не стесняйтесь пропустить этот раздел. В частности, если вы незнакомы с <em>классами</em> (обсуждаемыми в  <a class="ref" href="rails-flavored-ruby#sec:ruby_classes">Разделе&nbsp;4.4</a>), я предлагаю вернуться к этому разделу позже.</p>

<p>Мы начнем со структуры наследования для моделей. Сравнивая  <a class="ref" href="a-demo-app#code:demo_user_class">Листинг&nbsp;2.12</a> и <a class="ref" href="a-demo-app#code:demo_micropost_class">Листинг&nbsp;2.13</a>, мы видим, что и модель User и модель Micropost наследовались (через левую угловую скобку&nbsp;<code>&lt;</code>) от <code>ActiveRecord::Base</code>, который является базовым классом для моделей, предоставляемых библиотекой ActiveRecord; схема, резюмирующая это отношение, представлена на  <a class="ref" href="a-demo-app#fig:demo_model_inheritance">Рис.&nbsp;2.16</a>. Благодаря наследованию от <code>ActiveRecord::Base</code> наши объекты модели получают возможность связываться с базой данных, обрабатывать столбцы базы данных, как Ruby атрибуты, и так далее.</p>

<div class="label" id="code:demo_user_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.12.</span> <span class="description">Класс <code>User</code>, с наследованием.<br /> <code>app/models/user.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_micropost_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.13.</span> <span class="description">Класс <code>Micropost</code> с наследованием. <br /> <code>app/models/micropost.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">Micropost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig:demo_model_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_model_inheritance.png" alt="demo_model_inheritance" /></span></div><div class="caption"><span class="header">Рис. 2.16: </span><span class="description">Иерархия наследования для моделей User и Micropost.</span></div></div>


<p>Структура наследования для контроллеров лишь немногим более сложная. Сравнивая <a class="ref" href="a-demo-app#code:demo_users_controller_class">Листинг&nbsp;2.14</a> и <a class="ref" href="a-demo-app#code:demo_microposts_controller_class">Листинг&nbsp;2.15</a>, мы видим, что и контроллер User и контроллер Micropost наследовались от Application controller. Исследуя  <a class="ref" href="a-demo-app#code:demo_application_controller_class">Листинг&nbsp;2.16</a>, мы видим, что сам <code>ApplicationController</code> наследует от <code>ActionController::Base</code>;  это базовый класс для контроллеров, обеспеченных  Rails библиотекой Action Pack. Отношения между этими классами иллюстрируются в <a class="ref" href="a-demo-app#fig:demo_controller_inheritance">Рис.&nbsp;2.17</a>.</p>

<div class="label" id="code:demo_users_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.14.</span> <span class="description">Класс <code>UsersController</code>, с наследованием. <br /> <code>app/controllers/users_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_microposts_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.15.</span> <span class="description">Класс <code>MicropostsController</code>, с наследованием. <br /> <code>app/controllers/microposts_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">MicropostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="code:demo_application_controller_class"></div>


<div class="codelisting">
<div class="listing"><span class="header">Листинг 2.16.</span> <span class="description">Класс <code>ApplicationController</code>, с наследованием.<br /> <code>app/controllers/application_controller.rb</code></span>
</div>
<div class="code"><div class="highlight"><pre><span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>
  <span class="o">.</span>
  <span class="o">.</span>
  <span class="o">.</span>
<span class="k">end</span>
</pre></div>
</div></div>




<div class="label" id="fig:demo_controller_inheritance"></div>


<div class="figure"><div class="center"><span class="graphic"><img src="/images/figures/demo_controller_inheritance.png" alt="demo_controller_inheritance" /></span></div><div class="caption"><span class="header">Рис. 2.17: </span><span class="description">Иерархия наследования для контроллеров Users и Microposts.</span></div></div>


<p>Как и с наследованием моделей, будучи, в конечном счете, наследниками  <code>ActionController::Base</code> и Users и Microposts контроллеры имеют большое количество функций, таких как возможность управлять объектами модели, фильтровать входящие запросы HTTP, и визуализировать представления как HTML. Так как все контроллеры Rails наследовались от <code>ApplicationController</code>, правила, определенные в ApplicationController автоматически, применяются к каждому действию в приложении. Например, в <a class="ref" href="sign-up#sec:filtering_parameter_logging">Разделе&nbsp;8.2.4</a> мы увидим, как определение правила в Application контроллере позволяет нам фильтровать пароли от всех файлов системного журнала Rails, таким образом избегая серьезного потенциального нарушения защиты.</p>

<div class="label" id="sec:deploying_the_demo_app"></div>


<h3><a id="sec:2.3.5" href="a-demo-app#sec:deploying_the_demo_app" class="heading"><span class="number">2.3.5</span> Развертывание demo app</a></h3>


<p>Закончив ресурс Microposts, мы можем отправить репозиторий на GitHub:<sup class="footnote" id="fnref:2.14"><a href="#fn:2.14">14</a></sup></p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> git add .
<span class="gp">$</span> git commit -a -m <span class="s2">&quot;Done with the demo app&quot;</span>
<span class="gp">$</span> git push
</pre></div>
</div>


<p>Можно также развернуть demo app на Heroku:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> heroku create
<span class="gp">$</span> git push heroku master
<span class="gp">$</span> heroku rake db:migrate
</pre></div>
</div>


<p>(Если это не работает у вас, см. примечание для <a class="ref" href="beginning#code:gemfile_sqlite_heroku">Листинга&nbsp;1.9</a> для возможного исправления ошибки.) Отметим здесь заключительную строку, которая управляет миграциями базы данных на сервере Heroku. Это обновляет базу данных в Heroku с необходимой моделью данных пользователь/микросообщение. Если вы хотите также отправить <em>данные</em> можете сделать это используя <tt>taps</tt> gem и <code>db:push</code>:</p>

<div class="code"><div class="highlight"><pre><span class="gp">$</span> <span class="o">[</span>sudo<span class="o">]</span> gem install taps
<span class="gp">$</span> heroku db:push
</pre></div>
</div>




<h2><a id="sec:2.4" href="a-demo-app#sec:2.4" class="heading"><span class="number">2.4</span> Заключение</a></h2>


<p>Мы подошли к концу 9 144 метрового (30,000-foot ) обзора Rails приложения. У demo app, разработанного в этой главе, есть несколько достоинств и масса недостатков. <br /></p>

<p><strong>Достоинства</strong></p>

<ul><li>Общее представление о Rails</li>
<li>Введение в MVC</li>
<li>Первый вкус архитектуры REST</li>
<li>Начальное моделирование данных</li>
<li>Живое, поддерживаемое базой данных веб-приложение в production<sup class="footnote" id="fnref:2.15"><a href="#fn:2.15">15</a></sup></li>
</ul>


<p><strong>Недостатки</strong></p>

<ul>
<li>Нет собственного макета или стиля</li>
<li>Нет статических страниц (таких как "Главная" или "О нас")</li>
<li>Нет паролей пользователя</li>
<li>Нет изображений пользователя</li>
<li>Нет регистрации</li>
<li>Нет безопасности</li>
<li>Нет автоматической связи пользователь/микросообщение</li>
<li>Нет понятий &ldquo;following&rdquo; или &ldquo;followed&rdquo;</li>
<li>Нет потока (ленты) микросообщений</li>
<li>Нет разработки через тестирование</li>
<li><strong>Нет реального понимания</strong></li></ul>


<p>Остальная часть этого учебника посвящена усилению достоинств и устранению недостатков.</p>

<div class="navigation">  <a class="prev_page" href="beginning#top">
    &laquo;&nbsp;<span class="number">Глава 1</span> От нуля к развертыванию
  </a>
  <a class="next_page" href="static-pages#top">
    <span class="number">Глава 3</span> В основном статические страницы&nbsp;&raquo;
  </a>
</div><div class="footnotes">
<ol>
<li id="fn:2.1">Я советую вам не слишком присматриваться к сгенерированному коду; на данном этапе, это только смутит вас.&nbsp;<a class="arrow" href="#fnref:2.1">&uarr;</a></li>
<li id="fn:2.2">Вспомните, что команда <code>rails</code> генерирует дефолтный <code>.gitignore</code> файл, но в зависимости от вашей системы можно найти, что увеличенный файл из <a class="ref" href="beginning#code:gitignore">Листинга&nbsp;1.6</a> более удобен.&nbsp;<a class="arrow" href="#fnref:2.2">&uarr;</a></li>
<li id="fn:2.3">Моделируя более длинные сообщения,  для нормального (не микро) блога, следует использовать тип <code>text</code> вместо <code>string</code>.&nbsp;<a class="arrow" href="#fnref:2.3">&uarr;</a></li>
<li id="fn:2.4">Имя scaffold следует за соглашением в соответствии с которым, <em>модели</em> имеют единственное число, в отличие от ресурсов и контроллеров, которые используются во множественном числе. Таким образом, у нас есть <em>User</em> вместо <em>Users</em>.&nbsp;<a class="arrow" href="#fnref:2.4">&uarr;</a></li>
<li id="fn:2.5">User id необходим как <em>первичный ключ</em> в базе данных.&nbsp;<a class="arrow" href="#fnref:2.5">&uarr;</a></li>
<li id="fn:2.6">Начиная отсюда <tt>http://localhost:3000</tt> часть адреса очевидна всякий раз, когда мы разрабатываем локально, и я буду обычно опускать ее.&nbsp;<a class="arrow" href="#fnref:2.6">&uarr;</a></li>
<li id="fn:2.7">Некоторые источники утверждают, что представление возвращает HTML непосредственно браузеру (через веб-сервер, такой как Apache или Nginx). Независимо от деталей реализации я предпочитаю думать о контроллере как о центральном концентраторе через который проходят информационные потоки всего приложения.&nbsp;<a class="arrow" href="#fnref:2.7">&uarr;</a></li>
<li id="fn:2.8">Странная запись <code>:users</code> является <em>символом</em>, о котором мы узнаем в  <a class="ref" href="rails-flavored-ruby#sec:hashes_and_symbols">Разделе&nbsp;4.3.3</a>.&nbsp;<a class="arrow" href="#fnref:2.8">&uarr;</a></li>
<li id="fn:2.9">Код scaffold является уродливым и запутывающим, поэтому я обрезал его.&nbsp;<a class="arrow" href="#fnref:2.9">&uarr;</a></li>
<li id="fn:2.10">Помните, вы, как предполагается, не понимаете этот код сейчас. Он показан только в целях иллюстрации.&nbsp;<a class="arrow" href="#fnref:2.10">&uarr;</a></li>
<li id="fn:2.11">Как и с User scaffold, генератор scaffold для микросообщений следует сингулярному соглашению для моделей Rails; таким образом, мы имеем, <code>generate Micropost</code>, а не <code>generate MicropostS</code>.&nbsp;<a class="arrow" href="#fnref:2.11">&uarr;</a></li>
<li id="fn:2.12">У кода scaffold могут быть дополнительные новые строки по сравнению с <a class="ref" href="a-demo-app#code:demo_microposts_resource">Листингом&nbsp;2.7</a>; это не повод для беспокойства, поскольку Ruby игнорирует дополнительные новые строки.&nbsp;<a class="arrow" href="#fnref:2.12">&uarr;</a></li>
<li id="fn:2.13">Ваше приглашение командной строки, вероятно, будет чем-то вроде <code>ruby-1.9.2-head &gt;</code>, но я буду использовать <code>&gt;&gt;</code> чтобы приглашение не было связано с определенной версией Ruby.&nbsp;<a class="arrow" href="#fnref:2.13">&uarr;</a></li>
<li id="fn:2.14">Обычно, следует сделать меньшие, более частые фиксации, но для целей этой главы единственная большая фиксация в конце это нормально.&nbsp;<a class="arrow" href="#fnref:2.14">&uarr;</a></li>
<li id="fn:2.15">Если вы развертывали в Heroku в <a class="ref" href="a-demo-app#sec:deploying_the_demo_app">Разделе&nbsp;2.3.5</a>.&nbsp;<a class="arrow" href="#fnref:2.15">&uarr;</a></li>
</ol>
</div>

